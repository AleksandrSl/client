!function(){function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={};var r=function(e){var t=n[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t};(function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)n[t[r]]=e[t[r]]})(JSON.parse('{"5scof":"index.b379df14.js","16ppc":"refresh.7d4ee837.svg","46GSN":"success.21223f95.svg","5ukcI":"offline.713546b3.svg","2zEXf":"error.43d2277f.svg","2KpQ0":"offline.0548b834.png","6hsse":"normal.0b21cb84.png","bXmWT":"error.1503a905.png"}'));var o,i,a={};let s=()=>({events:{},emit(e,...t){for(let n of this.events[e]||[])n(...t)},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=this.events[e].filter((e=>e!==t))}});i={WsConnection:class{constructor(e,t,n){if(this.connected=!1,this.emitter=s(),t)this.Class=t;else{if("undefined"==typeof WebSocket)throw new Error("No WebSocket support");this.Class=WebSocket}this.url=e,this.opts=n}init(e){e.onerror=e=>{this.emitter.emit("error",e.error||new Error("WS Error"))},e.onclose=()=>{this.onclose()},e.onmessage=e=>{let t;try{t=JSON.parse(e.data)}catch{return void this.error(e.data)}this.emitter.emit("message",t)},this.ws=e}connect(){return this.ws?Promise.resolve():(this.emitter.emit("connecting"),this.init(new this.Class(this.url,void 0,this.opts)),new Promise((e=>{this.ws.onopen=()=>{this.connected=!0,this.emitter.emit("connect"),e()}})))}disconnect(){this.ws&&(this.ws.onclose=void 0,this.ws.close(),this.onclose())}on(e,t){return this.emitter.on(e,t)}send(e){this.ws&&this.ws.readyState===this.ws.OPEN?this.ws.send(JSON.stringify(e)):this.emitter.emit("error",new Error("WS was closed"))}error(e){let t=new Error("Wrong message format");t.received=e,this.emitter.emit("error",t)}onclose(){this.ws&&(this.connected=!1,this.emitter.emit("disconnect"),this.ws=void 0)}}};let{WsConnection:c}=i;o={ServerConnection:class extends c{constructor(e){super(void 0,!0),this.connected=!0,this.init(e)}connect(){throw new Error("ServerConnection accepts already connected WebSocket instance and could not reconnect it")}}};let{ServerConnection:l}=o;var u,d,p,f,y,h,g,m,b,v=!1;function w(){throw new Error("setTimeout has not been defined")}function S(){throw new Error("clearTimeout has not been defined")}function E(e){if(f===setTimeout)return setTimeout(e,0);if((f===w||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function A(){g&&m&&(g=!1,m.length?h=m.concat(h):b=-1,h.length&&P())}function P(){if(!g){var e=E(A);g=!0;for(var t=h.length;t;){for(m=h,h=[];++b<t;)m&&m[b].run();b=-1,t=h.length}m=null,g=!1,function(e){if(y===clearTimeout)return clearTimeout(e);if((y===S||!y)&&clearTimeout)return y=clearTimeout,clearTimeout(e);try{y(e)}catch(t){try{return y.call(null,e)}catch(t){return y.call(this,e)}}}(e)}}function O(e,t){this.fun=e,this.array=t}function I(){}function j(){return v||(v=!0,d={},p=d={},function(){try{f="function"==typeof setTimeout?setTimeout:w}catch(e){f=w}try{y="function"==typeof clearTimeout?clearTimeout:S}catch(e){y=S}}(),h=[],g=!1,b=-1,p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new O(e,t)),1!==h.length||g||E(P)},O.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=I,p.addListener=I,p.once=I,p.off=I,p.removeListener=I,p.removeAllListeners=I,p.emit=I,p.prependListener=I,p.prependOnceListener=I,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}),d}var x={};function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N,M,L={};function U(e,t,n){n||(n=Error);var r=function(n){function r(n,o,i){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(a=k(this,R(r).call(this,function(e,n,r){return"string"==typeof t?t:t(e,n,r)}(n,o,i)))).code=e,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(r,n),r}(n);L[e]=r}function C(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}U("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError),U("ERR_INVALID_ARG_TYPE",(function(e,t,n){var r,o,i,a;if(void 0===N&&(N=kl()),N("string"==typeof e,"'name' must be a string"),"string"==typeof t&&(o="not ",t.substr(!i||i<0?0:+i,o.length)===o)?(r="must not be",t=t.replace(/^not /,"")):r="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))a="The ".concat(e," ").concat(r," ").concat(C(t,"type"));else{var s=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";a='The "'.concat(e,'" ').concat(s," ").concat(r," ").concat(C(t,"type"))}return a+=". Received type ".concat(T(n))}),TypeError);var D,_,B,q,W,z,H=!1;function V(){return H||(H=!0,D={},_="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,B=Object.prototype.toString,q=function(e){return!(_&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===B.call(e)},W=function(e){return!!q(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==B.call(e)&&"[object Function]"===B.call(e.callee)},z=function(){return q(arguments)}(),q.isLegacyArguments=W,D=z?q:W),D}var $,G,J,Y,X,K,Q,Z,ee=!1;function te(){return ee||(ee=!0,$={},G=Object.prototype.toString,J=Function.prototype.toString,Y=/^\s*(?:function)?\*/,X="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,K=Object.getPrototypeOf,Q=function(){if(!X)return!1;try{return Function("return function*() {}")()}catch(e){}}(),Z=Q?K(Q):{},$=function(e){return"function"==typeof e&&(!!Y.test(J.call(e))||(X?K(e)===Z:"[object GeneratorFunction]"===G.call(e)))}),$}var ne,re,oe,ie=!1;function ae(){return ie||(ie=!0,ne={},re=Object.prototype.hasOwnProperty,oe=Object.prototype.toString,ne=function(e,t,n){if("[object Function]"!==oe.call(t))throw new TypeError("iterator must be a function");var r=e.length;if(r===+r)for(var o=0;o<r;o++)t.call(n,e[o],o,e);else for(var i in e)re.call(e,i)&&t.call(n,e[i],i,e)}),ne}var se,ce,le=!1;function ue(){return le||(le=!0,se={},se=function(e,t,n){if(e.filter)return e.filter(t,n);if(null==e)throw new TypeError;if("function"!=typeof t)throw new TypeError;for(var r=[],o=0;o<e.length;o++)if(ce.call(e,o)){var i=e[o];t.call(n,i,o,e)&&r.push(i)}return r},ce=Object.prototype.hasOwnProperty),se}var de,pe,fe=!1;function ye(){return fe||(fe=!0,de={},pe=ue(),de=function(){return pe(["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],(function(e){return"function"==typeof t[e]}))}),de}var he,ge=!1;function me(){return ge||(ge=!0,he={},he=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0}),he}var be,ve,we,Se=!1;function Ee(){return Se||(Se=!0,be={},ve=t.Symbol,we=me(),be=function(){return"function"==typeof ve&&"function"==typeof Symbol&&"symbol"==typeof ve("foo")&&"symbol"==typeof Symbol("bar")&&we()}),be}var Ae,Pe,Oe,Ie,je,xe=!1;function Te(){return xe||(xe=!0,Ae={},Pe="Function.prototype.bind called on incompatible ",Oe=Array.prototype.slice,Ie=Object.prototype.toString,je="[object Function]",Ae=function(e){var t=this;if("function"!=typeof t||Ie.call(t)!==je)throw new TypeError(Pe+t);for(var n,r=Oe.call(arguments,1),o=function(){if(this instanceof n){var o=t.apply(this,r.concat(Oe.call(arguments)));return Object(o)===o?o:this}return t.apply(e,r.concat(Oe.call(arguments)))},i=Math.max(0,t.length-r.length),a=[],s=0;s<i;s++)a.push("$"+s);if(n=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")(o),t.prototype){var c=function(){};c.prototype=t.prototype,n.prototype=new c,c.prototype=null}return n}),Ae}var ke,Re,Fe=!1;function Ne(){return Fe||(Fe=!0,ke={},Re=Te(),ke=Function.prototype.bind||Re),ke}var Me,Le,Ue,Ce,De,_e,Be,qe,We,ze,He,Ve,$e,Ge,Je,Ye,Xe,Ke,Qe,Ze,et=!1;function tt(){return et||(et=!0,function(){if(Me={},Ue=TypeError,Ce=Object.getOwnPropertyDescriptor)try{Ce({},"")}catch(e){Ce=null}De=function(){throw new Ue},_e=Ce?function(){try{return De}catch(e){try{return Ce(arguments,"callee").get}catch(e){return De}}}():De,Be=Ee()(),qe=Object.getPrototypeOf||function(e){return e.__proto__},We=Le,ze=Le,He=Le,Ve=Le,$e="undefined"==typeof Uint8Array?Le:qe(Uint8Array),Ge={"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?Le:ArrayBuffer,"%ArrayBufferPrototype%":"undefined"==typeof ArrayBuffer?Le:ArrayBuffer.prototype,"%ArrayIteratorPrototype%":Be?qe([][Symbol.iterator]()):Le,"%ArrayPrototype%":Array.prototype,"%ArrayProto_entries%":Array.prototype.entries,"%ArrayProto_forEach%":Array.prototype.forEach,"%ArrayProto_keys%":Array.prototype.keys,"%ArrayProto_values%":Array.prototype.values,"%AsyncFromSyncIteratorPrototype%":Le,"%AsyncFunction%":ze,"%AsyncFunctionPrototype%":Le,"%AsyncGenerator%":Le,"%AsyncGeneratorFunction%":He,"%AsyncGeneratorPrototype%":Le,"%AsyncIteratorPrototype%":Ve&&Be&&Symbol.asyncIterator?Ve[Symbol.asyncIterator]():Le,"%Atomics%":"undefined"==typeof Atomics?Le:Atomics,"%Boolean%":Boolean,"%BooleanPrototype%":Boolean.prototype,"%DataView%":"undefined"==typeof DataView?Le:DataView,"%DataViewPrototype%":"undefined"==typeof DataView?Le:DataView.prototype,"%Date%":Date,"%DatePrototype%":Date.prototype,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%ErrorPrototype%":Error.prototype,"%eval%":eval,"%EvalError%":EvalError,"%EvalErrorPrototype%":EvalError.prototype,"%Float32Array%":"undefined"==typeof Float32Array?Le:Float32Array,"%Float32ArrayPrototype%":"undefined"==typeof Float32Array?Le:Float32Array.prototype,"%Float64Array%":"undefined"==typeof Float64Array?Le:Float64Array,"%Float64ArrayPrototype%":"undefined"==typeof Float64Array?Le:Float64Array.prototype,"%Function%":Function,"%FunctionPrototype%":Function.prototype,"%Generator%":Le,"%GeneratorFunction%":We,"%GeneratorPrototype%":Le,"%Int8Array%":"undefined"==typeof Int8Array?Le:Int8Array,"%Int8ArrayPrototype%":"undefined"==typeof Int8Array?Le:Int8Array.prototype,"%Int16Array%":"undefined"==typeof Int16Array?Le:Int16Array,"%Int16ArrayPrototype%":"undefined"==typeof Int16Array?Le:Int8Array.prototype,"%Int32Array%":"undefined"==typeof Int32Array?Le:Int32Array,"%Int32ArrayPrototype%":"undefined"==typeof Int32Array?Le:Int32Array.prototype,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Be?qe(qe([][Symbol.iterator]())):Le,"%JSON%":"object"==typeof JSON?JSON:Le,"%JSONParse%":"object"==typeof JSON?JSON.parse:Le,"%Map%":"undefined"==typeof Map?Le:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&Be?qe((new Map)[Symbol.iterator]()):Le,"%MapPrototype%":"undefined"==typeof Map?Le:Map.prototype,"%Math%":Math,"%Number%":Number,"%NumberPrototype%":Number.prototype,"%Object%":Object,"%ObjectPrototype%":Object.prototype,"%ObjProto_toString%":Object.prototype.toString,"%ObjProto_valueOf%":Object.prototype.valueOf,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?Le:Promise,"%PromisePrototype%":"undefined"==typeof Promise?Le:Promise.prototype,"%PromiseProto_then%":"undefined"==typeof Promise?Le:Promise.prototype.then,"%Promise_all%":"undefined"==typeof Promise?Le:Promise.all,"%Promise_reject%":"undefined"==typeof Promise?Le:Promise.reject,"%Promise_resolve%":"undefined"==typeof Promise?Le:Promise.resolve,"%Proxy%":"undefined"==typeof Proxy?Le:Proxy,"%RangeError%":RangeError,"%RangeErrorPrototype%":RangeError.prototype,"%ReferenceError%":ReferenceError,"%ReferenceErrorPrototype%":ReferenceError.prototype,"%Reflect%":"undefined"==typeof Reflect?Le:Reflect,"%RegExp%":RegExp,"%RegExpPrototype%":RegExp.prototype,"%Set%":"undefined"==typeof Set?Le:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&Be?qe((new Set)[Symbol.iterator]()):Le,"%SetPrototype%":"undefined"==typeof Set?Le:Set.prototype,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?Le:SharedArrayBuffer,"%SharedArrayBufferPrototype%":"undefined"==typeof SharedArrayBuffer?Le:SharedArrayBuffer.prototype,"%String%":String,"%StringIteratorPrototype%":Be?qe(""[Symbol.iterator]()):Le,"%StringPrototype%":String.prototype,"%Symbol%":Be?Symbol:Le,"%SymbolPrototype%":Be?Symbol.prototype:Le,"%SyntaxError%":SyntaxError,"%SyntaxErrorPrototype%":SyntaxError.prototype,"%ThrowTypeError%":_e,"%TypedArray%":$e,"%TypedArrayPrototype%":$e?$e.prototype:Le,"%TypeError%":Ue,"%TypeErrorPrototype%":Ue.prototype,"%Uint8Array%":"undefined"==typeof Uint8Array?Le:Uint8Array,"%Uint8ArrayPrototype%":"undefined"==typeof Uint8Array?Le:Uint8Array.prototype,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?Le:Uint8ClampedArray,"%Uint8ClampedArrayPrototype%":"undefined"==typeof Uint8ClampedArray?Le:Uint8ClampedArray.prototype,"%Uint16Array%":"undefined"==typeof Uint16Array?Le:Uint16Array,"%Uint16ArrayPrototype%":"undefined"==typeof Uint16Array?Le:Uint16Array.prototype,"%Uint32Array%":"undefined"==typeof Uint32Array?Le:Uint32Array,"%Uint32ArrayPrototype%":"undefined"==typeof Uint32Array?Le:Uint32Array.prototype,"%URIError%":URIError,"%URIErrorPrototype%":URIError.prototype,"%WeakMap%":"undefined"==typeof WeakMap?Le:WeakMap,"%WeakMapPrototype%":"undefined"==typeof WeakMap?Le:WeakMap.prototype,"%WeakSet%":"undefined"==typeof WeakSet?Le:WeakSet,"%WeakSetPrototype%":"undefined"==typeof WeakSet?Le:WeakSet.prototype},Je=Ne(),Ye=Je.call(Function.call,String.prototype.replace),Xe=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ke=/\\(\\)?/g,Qe=function(e){var t=[];return Ye(e,Xe,(function(e,n,r,o){t[t.length]=r?Ye(o,Ke,"$1"):n||e})),t},Ze=function(e,t){if(!(e in Ge))throw new SyntaxError("intrinsic "+e+" does not exist!");if(void 0===Ge[e]&&!t)throw new Ue("intrinsic "+e+" exists, but is not available. Please file an issue!");return Ge[e]},Me=function(e,t){if("string"!=typeof e||0===e.length)throw new TypeError("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new TypeError('"allowMissing" argument must be a boolean');for(var n=Qe(e),r=Ze("%"+(n.length>0?n[0]:"")+"%",t),o=1;o<n.length;o+=1)if(null!=r)if(Ce&&o+1>=n.length){var i=Ce(r,n[o]);if(!t&&!(n[o]in r))throw new Ue("base intrinsic for "+e+" exists, but the property is not available.");r=i&&"get"in i&&!("originalValue"in i.get)?i.get:r[n[o]]}else r=r[n[o]];return r}}()),Me}var nt,rt,ot,it,at,st,ct,lt,ut,dt=!1;function pt(){return dt||(dt=!0,function(){if(nt={},ot=Ne(),it=tt(),at=it("%Function.prototype.apply%"),st=it("%Function.prototype.call%"),ct=it("%Reflect.apply%",!0)||ot.call(st,at),lt=it("%Object.defineProperty%",!0))try{lt({},"a",{value:1})}catch(e){lt=null}nt=function(){return ct(ot,st,arguments)},ut=function(){return ct(ot,at,arguments)},lt?lt(nt,"apply",{value:ut}):(rt=ut,nt.apply=rt)}()),nt}var ft,yt,ht,gt,mt=!1;function bt(){return mt||(mt=!0,ft={},yt=tt(),ht=pt(),gt=ht(yt("String.prototype.indexOf")),ft=function(e,t){var n=yt(e,!!t);return"function"==typeof n&&gt(e,".prototype.")?ht(n):n}),ft}var vt,wt,St,Et=!1;function At(){return Et||(Et=!0,function(){if(vt={},wt=tt(),St=wt("%Object.getOwnPropertyDescriptor%"))try{St([],"length")}catch(e){St=null}vt=St}()),vt}var Pt,Ot,It,jt,xt,Tt,kt,Rt,Ft,Nt,Mt,Lt,Ut,Ct,Dt=!1;function _t(){return Dt||(Dt=!0,Pt={},Ot=ae(),It=ye(),jt=bt(),xt=jt("Object.prototype.toString"),Tt=Ee()(),kt=Tt&&"symbol"==typeof Symbol.toStringTag,Rt=It(),Ft=jt("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1},Nt=jt("String.prototype.slice"),Mt={},Lt=At(),Ut=Object.getPrototypeOf,kt&&Lt&&Ut&&Ot(Rt,(function(e){var n=new t[e];if(!(Symbol.toStringTag in n))throw new EvalError("this engine has support for Symbol.toStringTag, but "+e+" does not have the property! Please report this.");var r=Ut(n),o=Lt(r,Symbol.toStringTag);if(!o){var i=Ut(r);o=Lt(i,Symbol.toStringTag)}Mt[e]=o.get})),Ct=function(e){var t=!1;return Ot(Mt,(function(n,r){if(!t)try{t=n.call(e)===r}catch(e){}})),t},Pt=function(e){if(!e||"object"!=typeof e)return!1;if(!kt){var t=Nt(xt(e),8,-1);return Ft(Rt,t)>-1}return!!Lt&&Ct(e)}),Pt}var Bt,qt,Wt,zt,Ht,Vt,$t,Gt,Jt,Yt,Xt,Kt,Qt,Zt,en=!1;function tn(){return en||(en=!0,Bt={},qt=ae(),Wt=ye(),zt=bt(),Ht=zt("Object.prototype.toString"),Vt=Ee()(),$t=Vt&&"symbol"==typeof Symbol.toStringTag,Gt=Wt(),Jt=zt("String.prototype.slice"),Yt={},Xt=At(),Kt=Object.getPrototypeOf,$t&&Xt&&Kt&&qt(Gt,(function(e){if("function"==typeof t[e]){var n=new t[e];if(!(Symbol.toStringTag in n))throw new EvalError("this engine has support for Symbol.toStringTag, but "+e+" does not have the property! Please report this.");var r=Kt(n),o=Xt(r,Symbol.toStringTag);if(!o){var i=Kt(r);o=Xt(i,Symbol.toStringTag)}Yt[e]=o.get}})),Qt=function(e){var t=!1;return qt(Yt,(function(n,r){if(!t)try{var o=n.call(e);o===r&&(t=o)}catch(e){}})),t},Zt=_t(),Bt=function(e){return!!Zt(e)&&($t?Qt(e):Jt(Ht(e),8,-1))}),Bt}var nn,rn,on,an,sn,cn,ln,un,dn,pn,fn,yn,hn,gn,mn,bn,vn,wn,Sn,En,An,Pn,On,In,jn,xn,Tn,kn,Rn,Fn,Nn,Mn,Ln,Un,Cn,Dn,_n,Bn,qn,Wn,zn,Hn,Vn,$n,Gn,Jn,Yn,Xn,Kn=!1;function Qn(e){return e.call.bind(e)}function Zn(e,t){if("object"!=typeof e)return!1;try{return t(e),!0}catch(e){return!1}}function er(e){return"undefined"!=typeof Promise&&e instanceof Promise||null!==e&&"object"==typeof e&&"function"==typeof e.then&&"function"==typeof e.catch}function tr(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):sn(e)||Pr(e)}function nr(e){return"Uint8Array"===an(e)}function rr(e){return"Uint8ClampedArray"===an(e)}function or(e){return"Uint16Array"===an(e)}function ir(e){return"Uint32Array"===an(e)}function ar(e){return"Int8Array"===an(e)}function sr(e){return"Int16Array"===an(e)}function cr(e){return"Int32Array"===an(e)}function lr(e){return"Float32Array"===an(e)}function ur(e){return"Float64Array"===an(e)}function dr(e){return"BigInt64Array"===an(e)}function pr(e){return"BigUint64Array"===an(e)}function fr(e){return"[object Map]"===un(e)}function yr(e){return"undefined"!=typeof Map&&(fr.working?fr(e):e instanceof Map)}function hr(e){return"[object Set]"===un(e)}function gr(e){return"undefined"!=typeof Set&&(hr.working?hr(e):e instanceof Set)}function mr(e){return"[object WeakMap]"===un(e)}function br(e){return"undefined"!=typeof WeakMap&&(mr.working?mr(e):e instanceof WeakMap)}function vr(e){return"[object WeakSet]"===un(e)}function wr(e){return vr(e)}function Sr(e){return"[object ArrayBuffer]"===un(e)}function Er(e){return"undefined"!=typeof ArrayBuffer&&(Sr.working?Sr(e):e instanceof ArrayBuffer)}function Ar(e){return"[object DataView]"===un(e)}function Pr(e){return"undefined"!=typeof DataView&&(Ar.working?Ar(e):e instanceof DataView)}function Or(e){return"[object SharedArrayBuffer]"===un(e)}function Ir(e){return"undefined"!=typeof SharedArrayBuffer&&(Or.working?Or(e):e instanceof SharedArrayBuffer)}function jr(e){return"[object AsyncFunction]"===un(e)}function xr(e){return"[object Map Iterator]"===un(e)}function Tr(e){return"[object Set Iterator]"===un(e)}function kr(e){return"[object Generator]"===un(e)}function Rr(e){return"[object WebAssembly.Module]"===un(e)}function Fr(e){return Zn(e,dn)}function Nr(e){return Zn(e,pn)}function Mr(e){return Zn(e,fn)}function Lr(e){return cn&&Zn(e,yn)}function Ur(e){return ln&&Zn(e,hn)}function Cr(e){return Fr(e)||Nr(e)||Mr(e)||Lr(e)||Ur(e)}function Dr(e){return"undefined"!=typeof Uint8Array&&(Er(e)||Ir(e))}function _r(){return Kn||(Kn=!0,nn={},rn=V(),on=te(),an=tn(),sn=_t(),cn="undefined"!=typeof BigInt,ln="undefined"!=typeof Symbol,un=Qn(Object.prototype.toString),dn=Qn(Number.prototype.valueOf),pn=Qn(String.prototype.valueOf),fn=Qn(Boolean.prototype.valueOf),cn&&(yn=Qn(BigInt.prototype.valueOf)),ln&&(hn=Qn(Symbol.prototype.valueOf)),gn=rn,nn.isArgumentsObject=gn,mn=on,nn.isGeneratorFunction=mn,bn=sn,nn.isTypedArray=bn,vn=er,nn.isPromise=vn,wn=tr,nn.isArrayBufferView=wn,Sn=nr,nn.isUint8Array=Sn,En=rr,nn.isUint8ClampedArray=En,An=or,nn.isUint16Array=An,Pn=ir,nn.isUint32Array=Pn,On=ar,nn.isInt8Array=On,In=sr,nn.isInt16Array=In,jn=cr,nn.isInt32Array=jn,xn=lr,nn.isFloat32Array=xn,Tn=ur,nn.isFloat64Array=Tn,kn=dr,nn.isBigInt64Array=kn,Rn=pr,nn.isBigUint64Array=Rn,fr.working="undefined"!=typeof Map&&fr(new Map),Fn=yr,nn.isMap=Fn,hr.working="undefined"!=typeof Set&&hr(new Set),Nn=gr,nn.isSet=Nn,mr.working="undefined"!=typeof WeakMap&&mr(new WeakMap),Mn=br,nn.isWeakMap=Mn,vr.working="undefined"!=typeof WeakSet&&vr(new WeakSet),Ln=wr,nn.isWeakSet=Ln,Sr.working="undefined"!=typeof ArrayBuffer&&Sr(new ArrayBuffer),Un=Er,nn.isArrayBuffer=Un,Ar.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&Ar(new DataView(new ArrayBuffer(1),0,1)),Cn=Pr,nn.isDataView=Cn,Or.working="undefined"!=typeof SharedArrayBuffer&&Or(new SharedArrayBuffer),Dn=Ir,nn.isSharedArrayBuffer=Dn,_n=jr,nn.isAsyncFunction=_n,Bn=xr,nn.isMapIterator=Bn,qn=Tr,nn.isSetIterator=qn,Wn=kr,nn.isGeneratorObject=Wn,zn=Rr,nn.isWebAssemblyCompiledModule=zn,Hn=Fr,nn.isNumberObject=Hn,Vn=Nr,nn.isStringObject=Vn,$n=Mr,nn.isBooleanObject=$n,Gn=Lr,nn.isBigIntObject=Gn,Jn=Ur,nn.isSymbolObject=Jn,Yn=Cr,nn.isBoxedPrimitive=Yn,Xn=Dr,nn.isAnyArrayBuffer=Xn,["isProxy","isExternal","isModuleNamespaceObject"].forEach((function(e){Object.defineProperty(nn,e,{enumerable:!1,value:function(){throw new Error(e+" is not supported in userland")}})}))),nn}var Br,qr=!1;function Wr(){return qr||(qr=!0,Br={},Br=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}),Br}var zr,Hr=!1;function Vr(){return Hr||(Hr=!0,zr={},zr="function"==typeof Object.create?function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}),zr}var $r,Gr,Jr,Yr,Xr,Kr,Qr,Zr,eo,to,no,ro,oo,io,ao,so,co,lo,uo,po,fo,yo,ho,go,mo,bo,vo,wo,So,Eo,Ao,Po,Oo,Io=!1;function jo(e,t){var n={seen:[],stylize:To};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),Mo(t)?n.showHidden=t:t&&$r._extend(n,t),Bo(n.showHidden)&&(n.showHidden=!1),Bo(n.depth)&&(n.depth=2),Bo(n.colors)&&(n.colors=!1),Bo(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=xo),ko(n,e,n.depth)}function xo(e,t){var n=jo.styles[t];return n?"["+jo.colors[n][0]+"m"+e+"["+jo.colors[n][1]+"m":e}function To(e,t){return e}function ko(e,t,n){if(e.customInspect&&t&&Vo(t.inspect)&&t.inspect!==$r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(n,e);return Do(r)||(r=ko(e,r,n)),r}var o=function(e,t){if(Bo(t))return e.stylize("undefined","undefined");if(Do(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(Co(t))return e.stylize(""+t,"number");if(Mo(t))return e.stylize(""+t,"boolean");if(Lo(t))return e.stylize("null","null")}(e,t);if(o)return o;var i=Object.keys(t),a=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(i);if(e.showHidden&&(i=Object.getOwnPropertyNames(t)),Ho(t)&&(i.indexOf("message")>=0||i.indexOf("description")>=0))return Ro(t);if(0===i.length){if(Vo(t)){var s=t.name?": "+t.name:"";return e.stylize("[Function"+s+"]","special")}if(qo(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(zo(t))return e.stylize(Date.prototype.toString.call(t),"date");if(Ho(t))return Ro(t)}var c,l="",u=!1,d=["{","}"];(No(t)&&(u=!0,d=["[","]"]),Vo(t))&&(l=" [Function"+(t.name?": "+t.name:"")+"]");return qo(t)&&(l=" "+RegExp.prototype.toString.call(t)),zo(t)&&(l=" "+Date.prototype.toUTCString.call(t)),Ho(t)&&(l=" "+Ro(t)),0!==i.length||u&&0!=t.length?n<0?qo(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=u?function(e,t,n,r,o){for(var i=[],a=0,s=t.length;a<s;++a)Xo(t,String(a))?i.push(Fo(e,t,n,r,String(a),!0)):i.push("");return o.forEach((function(o){o.match(/^\d+$/)||i.push(Fo(e,t,n,r,o,!0))})),i}(e,t,n,a,i):i.map((function(r){return Fo(e,t,n,a,r,u)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,l,d)):d[0]+l+d[1]}function Ro(e){return"["+Error.prototype.toString.call(e)+"]"}function Fo(e,t,n,r,o,i){var a,s,c;if((c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),Xo(r,o)||(a="["+o+"]"),s||(e.seen.indexOf(c.value)<0?(s=Lo(n)?ko(e,c.value,null):ko(e,c.value,n-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),Bo(a)){if(i&&o.match(/^\d+$/))return s;(a=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function No(e){return Array.isArray(e)}function Mo(e){return"boolean"==typeof e}function Lo(e){return null===e}function Uo(e){return null==e}function Co(e){return"number"==typeof e}function Do(e){return"string"==typeof e}function _o(e){return"symbol"==typeof e}function Bo(e){return void 0===e}function qo(e){return Wo(e)&&"[object RegExp]"===Go(e)}function Wo(e){return"object"==typeof e&&null!==e}function zo(e){return Wo(e)&&"[object Date]"===Go(e)}function Ho(e){return Wo(e)&&("[object Error]"===Go(e)||e instanceof Error)}function Vo(e){return"function"==typeof e}function $o(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function Go(e){return Object.prototype.toString.call(e)}function Jo(e){return e<10?"0"+e.toString(10):e.toString(10)}function Yo(){var e=new Date,t=[Jo(e.getHours()),Jo(e.getMinutes()),Jo(e.getSeconds())].join(":");return[e.getDate(),vo[e.getMonth()],t].join(" ")}function Xo(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ko(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}function Qo(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);var r=t.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var o=this,i=function(){return r.apply(o,arguments)};e.apply(this,t).then((function(e){Gr.nextTick(i.bind(null,null,e))}),(function(e){Gr.nextTick(Ko.bind(null,e,i))}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,Jr(e)),t}function Zo(){return Io||(Io=!0,$r={},Gr=j(),Jr=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},Yr=/%[sdj%]/g,Xr=function(e){if(!Do(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(jo(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,i=String(e).replace(Yr,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),a=r[n];n<o;a=r[++n])Lo(a)||!Wo(a)?i+=" "+a:i+=" "+jo(a);return i},$r.format=Xr,Kr=function(e,t){if(void 0!==Gr&&!0===Gr.noDeprecation)return e;if(void 0===Gr)return function(){return $r.deprecate(e,t).apply(this,arguments)};var n=!1;return function(){if(!n){if(Gr.throwDeprecation)throw new Error(t);Gr.traceDeprecation?console.trace(t):console.error(t),n=!0}return e.apply(this,arguments)}},$r.deprecate=Kr,Qr={},Zr=/^$/,eo=function(e){if(e=e.toUpperCase(),!Qr[e])if(Zr.test(e)){var t=Gr.pid;Qr[e]=function(){var n=$r.format.apply($r,arguments);console.error("%s %d: %s",e,t,n)}}else Qr[e]=function(){};return Qr[e]},$r.debuglog=eo,to=jo,$r.inspect=to,jo.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},jo.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},no=_r(),$r.types=no,ro=No,$r.isArray=ro,oo=Mo,$r.isBoolean=oo,io=Lo,$r.isNull=io,ao=Uo,$r.isNullOrUndefined=ao,so=Co,$r.isNumber=so,co=Do,$r.isString=co,lo=_o,$r.isSymbol=lo,uo=Bo,$r.isUndefined=uo,po=qo,$r.isRegExp=po,$r.types.isRegExp=qo,fo=Wo,$r.isObject=fo,yo=zo,$r.isDate=yo,$r.types.isDate=zo,ho=Ho,$r.isError=ho,$r.types.isNativeError=Ho,go=Vo,$r.isFunction=go,mo=$o,$r.isPrimitive=mo,bo=Wr(),$r.isBuffer=bo,vo=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wo=function(){console.log("%s - %s",Yo(),$r.format.apply($r,arguments))},$r.log=wo,So=Vr(),$r.inherits=So,Eo=function(e,t){if(!t||!Wo(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e},$r._extend=Eo,Ao="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0,Po=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(Ao&&e[Ao]){var t;if("function"!=typeof(t=e[Ao]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,Ao,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),o=[],i=0;i<arguments.length;i++)o.push(arguments[i]);o.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,o)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Ao&&Object.defineProperty(t,Ao,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,Jr(e))},$r.promisify=Po,$r.promisify.custom=Ao,Oo=Qo,$r.callbackify=Oo),$r}U("ERR_INVALID_ARG_VALUE",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"is invalid";void 0===M&&(M=Zo());var r=M.inspect(t);return r.length>128&&(r="".concat(r.slice(0,128),"...")),"The argument '".concat(e,"' ").concat(n,". Received ").concat(r)}),TypeError,RangeError),U("ERR_INVALID_RETURN_VALUE",(function(e,t,n){var r;return r=n&&n.constructor&&n.constructor.name?"instance of ".concat(n.constructor.name):"type ".concat(T(n)),"Expected ".concat(e,' to be returned from the "').concat(t,'"')+" function but got ".concat(r,".")}),TypeError),U("ERR_MISSING_ARGS",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];void 0===N&&(N=kl()),N(t.length>0,"At least one arg needs to be specified");var r="The ",o=t.length;switch(t=t.map((function(e){return'"'.concat(e,'"')})),o){case 1:r+="".concat(t[0]," argument");break;case 2:r+="".concat(t[0]," and ").concat(t[1]," arguments");break;default:r+=t.slice(0,o-1).join(", "),r+=", and ".concat(t[o-1]," arguments")}return"".concat(r," must be specified")}),TypeError);var ei=L;x.codes=ei;var ti,ni=j();function ri(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ii(e,t){return!t||"object"!==pi(t)&&"function"!=typeof t?ai(e):t}function ai(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function si(e){var t="function"==typeof Map?new Map:void 0;return(si=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return li(e,arguments,di(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ui(r,e)})(e)}function ci(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function li(e,t,n){return(li=ci()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&ui(o,n.prototype),o}).apply(null,arguments)}function ui(e,t){return(ui=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function di(e){return(di=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pi(e){return(pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var fi=Zo().inspect,yi=ei.ERR_INVALID_ARG_TYPE;function hi(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}var gi="",mi="",bi="",vi="",wi={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"};function Si(e){var t=Object.keys(e),n=Object.create(Object.getPrototypeOf(e));return t.forEach((function(t){n[t]=e[t]})),Object.defineProperty(n,"message",{value:e.message}),n}function Ei(e){return fi(e,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}function Ai(e,t,n){var r="",o="",i=0,a="",s=!1,c=Ei(e),l=c.split("\n"),u=Ei(t).split("\n"),d=0,p="";if("strictEqual"===n&&"object"===pi(e)&&"object"===pi(t)&&null!==e&&null!==t&&(n="strictEqualObject"),1===l.length&&1===u.length&&l[0]!==u[0]){var f=l[0].length+u[0].length;if(f<=10){if(!("object"===pi(e)&&null!==e||"object"===pi(t)&&null!==t||0===e&&0===t))return"".concat(wi[n],"\n\n")+"".concat(l[0]," !== ").concat(u[0],"\n")}else if("strictEqualObject"!==n){if(f<(ni.stderr&&ni.stderr.isTTY?ni.stderr.columns:80)){for(;l[0][d]===u[0][d];)d++;d>2&&(p="\n  ".concat(function(e,t){if(t=Math.floor(t),0==e.length||0==t)return"";var n=e.length*t;for(t=Math.floor(Math.log(t)/Math.log(2));t;)e+=e,t--;return e+e.substring(0,n-e.length)}(" ",d),"^"),d=0)}}}for(var y=l[l.length-1],h=u[u.length-1];y===h&&(d++<2?a="\n  ".concat(y).concat(a):r=y,l.pop(),u.pop(),0!==l.length&&0!==u.length);)y=l[l.length-1],h=u[u.length-1];var g=Math.max(l.length,u.length);if(0===g){var m=c.split("\n");if(m.length>30)for(m[26]="".concat(gi,"...").concat(vi);m.length>27;)m.pop();return"".concat(wi.notIdentical,"\n\n").concat(m.join("\n"),"\n")}d>3&&(a="\n".concat(gi,"...").concat(vi).concat(a),s=!0),""!==r&&(a="\n  ".concat(r).concat(a),r="");var b=0,v=wi[n]+"\n".concat(mi,"+ actual").concat(vi," ").concat(bi,"- expected").concat(vi),w=" ".concat(gi,"...").concat(vi," Lines skipped");for(d=0;d<g;d++){var S=d-i;if(l.length<d+1)S>1&&d>2&&(S>4?(o+="\n".concat(gi,"...").concat(vi),s=!0):S>3&&(o+="\n  ".concat(u[d-2]),b++),o+="\n  ".concat(u[d-1]),b++),i=d,r+="\n".concat(bi,"-").concat(vi," ").concat(u[d]),b++;else if(u.length<d+1)S>1&&d>2&&(S>4?(o+="\n".concat(gi,"...").concat(vi),s=!0):S>3&&(o+="\n  ".concat(l[d-2]),b++),o+="\n  ".concat(l[d-1]),b++),i=d,o+="\n".concat(mi,"+").concat(vi," ").concat(l[d]),b++;else{var E=u[d],A=l[d],P=A!==E&&(!hi(A,",")||A.slice(0,-1)!==E);P&&hi(E,",")&&E.slice(0,-1)===A&&(P=!1,A+=","),P?(S>1&&d>2&&(S>4?(o+="\n".concat(gi,"...").concat(vi),s=!0):S>3&&(o+="\n  ".concat(l[d-2]),b++),o+="\n  ".concat(l[d-1]),b++),i=d,o+="\n".concat(mi,"+").concat(vi," ").concat(A),r+="\n".concat(bi,"-").concat(vi," ").concat(E),b+=2):(o+=r,r="",1!==S&&0!==d||(o+="\n  ".concat(A),b++))}if(b>20&&d<g-2)return"".concat(v).concat(w,"\n").concat(o,"\n").concat(gi,"...").concat(vi).concat(r,"\n")+"".concat(gi,"...").concat(vi)}return"".concat(v).concat(s?w:"","\n").concat(o).concat(r).concat(a).concat(p)}var Pi=function(e){function t(e){var n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),"object"!==pi(e)||null===e)throw new yi("options","Object",e);var r=e.message,o=e.operator,i=e.stackStartFn,a=e.actual,s=e.expected,c=Error.stackTraceLimit;if(Error.stackTraceLimit=0,null!=r)n=ii(this,di(t).call(this,String(r)));else if(ni.stderr&&ni.stderr.isTTY&&(ni.stderr&&ni.stderr.getColorDepth&&1!==ni.stderr.getColorDepth()?(gi="[34m",mi="[32m",vi="[39m",bi="[31m"):(gi="",mi="",vi="",bi="")),"object"===pi(a)&&null!==a&&"object"===pi(s)&&null!==s&&"stack"in a&&a instanceof Error&&"stack"in s&&s instanceof Error&&(a=Si(a),s=Si(s)),"deepStrictEqual"===o||"strictEqual"===o)n=ii(this,di(t).call(this,Ai(a,s,o)));else if("notDeepStrictEqual"===o||"notStrictEqual"===o){var l=wi[o],u=Ei(a).split("\n");if("notStrictEqual"===o&&"object"===pi(a)&&null!==a&&(l=wi.notStrictEqualObject),u.length>30)for(u[26]="".concat(gi,"...").concat(vi);u.length>27;)u.pop();n=1===u.length?ii(this,di(t).call(this,"".concat(l," ").concat(u[0]))):ii(this,di(t).call(this,"".concat(l,"\n\n").concat(u.join("\n"),"\n")))}else{var d=Ei(a),p="",f=wi[o];"notDeepEqual"===o||"notEqual"===o?(d="".concat(wi[o],"\n\n").concat(d)).length>1024&&(d="".concat(d.slice(0,1021),"...")):(p="".concat(Ei(s)),d.length>512&&(d="".concat(d.slice(0,509),"...")),p.length>512&&(p="".concat(p.slice(0,509),"...")),"deepEqual"===o||"equal"===o?d="".concat(f,"\n\n").concat(d,"\n\nshould equal\n\n"):p=" ".concat(o," ").concat(p)),n=ii(this,di(t).call(this,"".concat(d).concat(p)))}return Error.stackTraceLimit=c,n.generatedMessage=!r,Object.defineProperty(ai(n),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),n.code="ERR_ASSERTION",n.actual=a,n.expected=s,n.operator=o,Error.captureStackTrace&&Error.captureStackTrace(ai(n),i),n.stack,n.name="AssertionError",ii(n)}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ui(e,t)}(t,e),n=t,(r=[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:fi.custom,value:function(e,t){return fi(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ri(e,t,n[t])}))}return e}({},t,{customInspect:!1,depth:0}))}}])&&oi(n.prototype,r),o&&oi(n,o),t}(si(Error));ti=Pi;var Oi,Ii=!1;function ji(e,t){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var i=Object.keys(Object(o)),a=0,s=i.length;a<s;a++){var c=i[a],l=Object.getOwnPropertyDescriptor(o,c);void 0!==l&&l.enumerable&&(n[c]=o[c])}}return n}function xi(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:ji})}function Ti(){return Ii||(Ii=!0,Oi={},Oi={assign:ji,polyfill:xi}),Oi}var ki,Ri,Fi=!1;function Ni(){return Fi||(Fi=!0,ki={},Ri=Object.prototype.toString,ki=function(e){var t=Ri.call(e),n="[object Arguments]"===t;return n||(n="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===Ri.call(e.callee)),n}),ki}var Mi,Li,Ui,Ci,Di,_i,Bi,qi,Wi,zi,Hi,Vi,$i,Gi=!1;function Ji(){return Gi||(Gi=!0,Mi={},Object.keys||(Ui=Object.prototype.hasOwnProperty,Ci=Object.prototype.toString,Di=Ni(),_i=Object.prototype.propertyIsEnumerable,Bi=!_i.call({toString:null},"toString"),qi=_i.call((function(){}),"prototype"),Wi=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],zi=function(e){var t=e.constructor;return t&&t.prototype===e},Hi={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Vi=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!Hi["$"+e]&&Ui.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{zi(window[e])}catch(e){return!0}}catch(e){return!0}return!1}(),$i=function(e){if("undefined"==typeof window||!Vi)return zi(e);try{return zi(e)}catch(e){return!1}},Li=function(e){var t=null!==e&&"object"==typeof e,n="[object Function]"===Ci.call(e),r=Di(e),o=t&&"[object String]"===Ci.call(e),i=[];if(!t&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var a=qi&&n;if(o&&e.length>0&&!Ui.call(e,0))for(var s=0;s<e.length;++s)i.push(String(s));if(r&&e.length>0)for(var c=0;c<e.length;++c)i.push(String(c));else for(var l in e)a&&"prototype"===l||!Ui.call(e,l)||i.push(String(l));if(Bi)for(var u=$i(e),d=0;d<Wi.length;++d)u&&"constructor"===Wi[d]||!Ui.call(e,Wi[d])||i.push(Wi[d]);return i}),Mi=Li),Mi}var Yi,Xi,Ki,Qi,Zi,ea,ta=!1;function na(){return ta||(ta=!0,Yi={},Xi=Array.prototype.slice,Ki=Ni(),Qi=Object.keys,Zi=Qi?function(e){return Qi(e)}:Ji(),ea=Object.keys,Zi.shim=function(){return Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return Ki(e)?ea(Xi.call(e)):ea(e)}):Object.keys=Zi,Object.keys||Zi},Yi=Zi),Yi}var ra,oa,ia,aa,sa,ca,la,ua,da,pa,fa,ya=!1;function ha(){return ya||(ya=!0,ra={},oa=na(),ia="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),aa=Object.prototype.toString,sa=Array.prototype.concat,ca=Object.defineProperty,la=function(e){return"function"==typeof e&&"[object Function]"===aa.call(e)},ua=function(){var e={};try{for(var t in ca(e,"x",{enumerable:!1,value:e}),e)return!1;return e.x===e}catch(e){return!1}},da=ca&&ua(),pa=function(e,t,n,r){(!(t in e)||la(r)&&r())&&(da?ca(e,t,{configurable:!0,enumerable:!1,value:n,writable:!0}):e[t]=n)},(fa=function(e,t){var n=arguments.length>2?arguments[2]:{},r=oa(t);ia&&(r=sa.call(r,Object.getOwnPropertySymbols(t)));for(var o=0;o<r.length;o+=1)pa(e,r[o],t[r[o]],n[r[o]])}).supportsDescriptors=!!da,ra=fa),ra}var ga,ma,ba=!1;function va(){return ba||(ba=!0,ga={},ma=Ne(),ga=ma.call(Function.call,Object.prototype.hasOwnProperty)),ga}var wa,Sa,Ea,Aa,Pa,Oa,Ia,ja,xa,Ta,ka,Ra,Fa,Na,Ma,La,Ua,Ca,Da,_a,Ba,qa,Wa,za,Ha,Va,$a=!1;function Ga(){return $a||($a=!0,function(){if(wa={},Ea=SyntaxError,Aa=Function,Pa=TypeError,Oa=function(e){try{return Function('"use strict"; return ('+e+").constructor;")()}catch(e){}},Ia=Object.getOwnPropertyDescriptor)try{Ia({},"")}catch(e){Ia=null}ja=function(){throw new Pa},xa=Ia?function(){try{return ja}catch(e){try{return Ia(arguments,"callee").get}catch(e){return ja}}}():ja,Ta=Ee()(),ka=Object.getPrototypeOf||function(e){return e.__proto__},Ra=Oa("async function* () {}"),Fa=Ra?Ra.prototype:Sa,Na=Fa?Fa.prototype:Sa,Ma="undefined"==typeof Uint8Array?Sa:ka(Uint8Array),La={"%AggregateError%":"undefined"==typeof AggregateError?Sa:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?Sa:ArrayBuffer,"%ArrayIteratorPrototype%":Ta?ka([][Symbol.iterator]()):Sa,"%AsyncFromSyncIteratorPrototype%":Sa,"%AsyncFunction%":Oa("async function () {}"),"%AsyncGenerator%":Fa,"%AsyncGeneratorFunction%":Ra,"%AsyncIteratorPrototype%":Na?ka(Na):Sa,"%Atomics%":"undefined"==typeof Atomics?Sa:Atomics,"%BigInt%":"undefined"==typeof BigInt?Sa:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?Sa:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?Sa:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?Sa:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?Sa:FinalizationRegistry,"%Function%":Aa,"%GeneratorFunction%":Oa("function* () {}"),"%Int8Array%":"undefined"==typeof Int8Array?Sa:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?Sa:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?Sa:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ta?ka(ka([][Symbol.iterator]())):Sa,"%JSON%":"object"==typeof JSON?JSON:Sa,"%Map%":"undefined"==typeof Map?Sa:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&Ta?ka((new Map)[Symbol.iterator]()):Sa,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?Sa:Promise,"%Proxy%":"undefined"==typeof Proxy?Sa:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?Sa:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?Sa:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&Ta?ka((new Set)[Symbol.iterator]()):Sa,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?Sa:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ta?ka(""[Symbol.iterator]()):Sa,"%Symbol%":Ta?Symbol:Sa,"%SyntaxError%":Ea,"%ThrowTypeError%":xa,"%TypedArray%":Ma,"%TypeError%":Pa,"%Uint8Array%":"undefined"==typeof Uint8Array?Sa:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?Sa:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?Sa:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?Sa:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?Sa:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?Sa:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?Sa:WeakSet},Ua={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ca=Ne(),Da=va(),_a=Ca.call(Function.call,Array.prototype.concat),Ba=Ca.call(Function.apply,Array.prototype.splice),qa=Ca.call(Function.call,String.prototype.replace),Wa=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,za=/\\(\\)?/g,Ha=function(e){var t=[];return qa(e,Wa,(function(e,n,r,o){t[t.length]=r?qa(o,za,"$1"):n||e})),t},Va=function(e,t){var n,r=e;if(Da(Ua,r)&&(r="%"+(n=Ua[r])[0]+"%"),Da(La,r)){var o=La[r];if(void 0===o&&!t)throw new Pa("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:o}}throw new Ea("intrinsic "+e+" does not exist!")},wa=function(e,t){if("string"!=typeof e||0===e.length)throw new Pa("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new Pa('"allowMissing" argument must be a boolean');var n=Ha(e),r=n.length>0?n[0]:"",o=Va("%"+r+"%",t),i=o.name,a=o.value,s=!1,c=o.alias;c&&(r=c[0],Ba(n,_a([0,1],c)));for(var l=1,u=!0;l<n.length;l+=1){var d=n[l];if("constructor"!==d&&u||(s=!0),Da(La,i="%"+(r+="."+d)+"%"))a=La[i];else if(null!=a){if(Ia&&l+1>=n.length){var p=Ia(a,d);if(u=!!p,!t&&!(d in a))throw new Pa("base intrinsic for "+e+" exists, but the property is not available.");a=u&&"get"in p&&!("originalValue"in p.get)?p.get:a[d]}else u=Da(a,d),a=a[d];u&&!s&&(La[i]=a)}}return a}}()),wa}var Ja,Ya,Xa,Ka,Qa,Za,es,ts,ns,rs=!1;function os(){return rs||(rs=!0,function(){if(Ja={},Xa=Ne(),Ka=Ga(),Qa=Ka("%Function.prototype.apply%"),Za=Ka("%Function.prototype.call%"),es=Ka("%Reflect.apply%",!0)||Xa.call(Za,Qa),ts=Ka("%Object.defineProperty%",!0))try{ts({},"a",{value:1})}catch(e){ts=null}Ja=function(){return es(Xa,Za,arguments)},ns=function(){return es(Xa,Qa,arguments)},ts?ts(Ja,"apply",{value:ns}):(Ya=ns,Ja.apply=Ya)}()),Ja}var is,as,ss=!1;function cs(){return ss||(ss=!0,is={},as=function(e){return e!=e},is=function(e,t){return 0===e&&0===t?1/e==1/t:e===t||!(!as(e)||!as(t))}),is}var ls,us,ds=!1;function ps(){return ds||(ds=!0,ls={},us=cs(),ls=function(){return"function"==typeof Object.is?Object.is:us}),ls}var fs,ys,hs,gs=!1;function ms(){return gs||(gs=!0,fs={},ys=ps(),hs=ha(),fs=function(){var e=ys();return hs(Object,{is:e},{is:function(){return Object.is!==e}}),e}),fs}var bs,vs,ws,Ss,Es,As,Ps,Os=!1;function Is(){return Os||(Os=!0,bs={},vs=ha(),ws=os(),Ss=cs(),Es=ps(),As=ms(),Ps=ws(Es(),Object),vs(Ps,{getPolyfill:Es,implementation:Ss,shim:As}),bs=Ps),bs}var js,xs=!1;function Ts(){return xs||(xs=!0,js={},js=function(e){return e!=e}),js}var ks,Rs,Fs=!1;function Ns(){return Fs||(Fs=!0,ks={},Rs=Ts(),ks=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:Rs}),ks}var Ms,Ls,Us,Cs=!1;function Ds(){return Cs||(Cs=!0,Ms={},Ls=ha(),Us=Ns(),Ms=function(){var e=Us();return Ls(Number,{isNaN:e},{isNaN:function(){return Number.isNaN!==e}}),e}),Ms}var _s,Bs,qs,Ws,zs,Hs,Vs=!1;function $s(){return Vs||(Vs=!0,_s={},Bs=ha(),qs=Ts(),Ws=Ns(),zs=Ds(),Hs=Ws(),Bs(Hs,{getPolyfill:Ws,implementation:qs,shim:zs}),_s=Hs),_s}var Gs,Js,Ys,Xs,Ks,Qs,Zs,ec,tc,nc,rc,oc,ic,ac,sc,cc,lc,uc,dc,pc,fc,yc,hc,gc,mc,bc,vc,wc,Sc,Ec,Ac,Pc,Oc=!1;function Ic(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function jc(e){return(jc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xc(e){return e.call.bind(e)}function Tc(e){if(0===e.length||e.length>10)return!0;for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(n<48||n>57)return!0}return 10===e.length&&e>=Math.pow(2,32)}function kc(e){return Object.keys(e).filter(Tc).concat(Qs(e).filter(Object.prototype.propertyIsEnumerable.bind(e)))}
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function Rc(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0}function Fc(e,t,n,r){if(e===t)return 0!==e||(!n||Ks(e,t));if(n){if("object"!==jc(e))return"number"==typeof e&&Zs(e)&&Zs(t);if("object"!==jc(t)||null===e||null===t)return!1;if(Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1}else{if(null===e||"object"!==jc(e))return(null===t||"object"!==jc(t))&&e==t;if(null===t||"object"!==jc(t))return!1}var o,i,a,s,c=nc(e);if(c!==nc(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;var l=kc(e),u=kc(t);return l.length===u.length&&Mc(e,t,n,r,Ec,l)}if("[object Object]"===c&&(!sc(e)&&sc(t)||!lc(e)&&lc(t)))return!1;if(ac(e)){if(!ac(t)||Date.prototype.getTime.call(e)!==Date.prototype.getTime.call(t))return!1}else if(cc(e)){if(!cc(t)||(a=e,s=t,!(Js?a.source===s.source&&a.flags===s.flags:RegExp.prototype.toString.call(a)===RegExp.prototype.toString.call(s))))return!1}else if(uc(e)||e instanceof Error){if(e.message!==t.message||e.name!==t.name)return!1}else{if(ic(e)){if(n||!mc(e)&&!bc(e)){if(!function(e,t){return e.byteLength===t.byteLength&&0===Rc(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}(e,t))return!1}else if(!function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}(e,t))return!1;var d=kc(e),p=kc(t);return d.length===p.length&&Mc(e,t,n,r,Sc,d)}if(lc(e))return!(!lc(t)||e.size!==t.size)&&Mc(e,t,n,r,Ac);if(sc(e))return!(!sc(t)||e.size!==t.size)&&Mc(e,t,n,r,Pc);if(oc(e)){if(i=t,(o=e).byteLength!==i.byteLength||0!==Rc(new Uint8Array(o),new Uint8Array(i)))return!1}else if(dc(e)&&!function(e,t){return pc(e)?pc(t)&&Ks(Number.prototype.valueOf.call(e),Number.prototype.valueOf.call(t)):fc(e)?fc(t)&&String.prototype.valueOf.call(e)===String.prototype.valueOf.call(t):yc(e)?yc(t)&&Boolean.prototype.valueOf.call(e)===Boolean.prototype.valueOf.call(t):hc(e)?hc(t)&&BigInt.prototype.valueOf.call(e)===BigInt.prototype.valueOf.call(t):gc(t)&&Symbol.prototype.valueOf.call(e)===Symbol.prototype.valueOf.call(t)}(e,t))return!1}return Mc(e,t,n,r,Sc)}function Nc(e,t){return t.filter((function(t){return tc(e,t)}))}function Mc(e,t,n,r,o,i){if(5===arguments.length){i=Object.keys(e);var a=Object.keys(t);if(i.length!==a.length)return!1}for(var s=0;s<i.length;s++)if(!ec(t,i[s]))return!1;if(n&&5===arguments.length){var c=Qs(e);if(0!==c.length){var l=0;for(s=0;s<c.length;s++){var u=c[s];if(tc(e,u)){if(!tc(t,u))return!1;i.push(u),l++}else if(tc(t,u))return!1}var d=Qs(t);if(c.length!==d.length&&Nc(t,d).length!==l)return!1}else{var p=Qs(t);if(0!==p.length&&0!==Nc(t,p).length)return!1}}if(0===i.length&&(o===Sc||o===Ec&&0===e.length||0===e.size))return!0;if(void 0===r)r={val1:new Map,val2:new Map,position:0};else{var f=r.val1.get(e);if(void 0!==f){var y=r.val2.get(t);if(void 0!==y)return f===y}r.position++}r.val1.set(e,r.position),r.val2.set(t,r.position);var h=Bc(e,t,n,i,r,o);return r.val1.delete(e),r.val2.delete(t),h}function Lc(e,t,n,r){for(var o=Ys(e),i=0;i<o.length;i++){var a=o[i];if(Fc(t,a,n,r))return e.delete(a),!0}return!1}function Uc(e){switch(jc(e)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":e=+e;case"number":if(Zs(e))return!1}return!0}function Cc(e,t,n){var r=Uc(n);return null!=r?r:t.has(r)&&!e.has(r)}function Dc(e,t,n,r,o){var i=Uc(n);if(null!=i)return i;var a=t.get(i);return!(void 0===a&&!t.has(i)||!Fc(r,a,!1,o))&&(!e.has(i)&&Fc(r,a,!1,o))}function _c(e,t,n,r,o,i){for(var a=Ys(e),s=0;s<a.length;s++){var c=a[s];if(Fc(n,c,o,i)&&Fc(r,t.get(c),o,i))return e.delete(c),!0}return!1}function Bc(e,t,n,r,o,i){var a=0;if(i===Ac){if(!function(e,t,n,r){for(var o=null,i=Ys(e),a=0;a<i.length;a++){var s=i[a];if("object"===jc(s)&&null!==s)null===o&&(o=new Set),o.add(s);else if(!t.has(s)){if(n)return!1;if(!Cc(e,t,s))return!1;null===o&&(o=new Set),o.add(s)}}if(null!==o){for(var c=Ys(t),l=0;l<c.length;l++){var u=c[l];if("object"===jc(u)&&null!==u){if(!Lc(o,u,n,r))return!1}else if(!n&&!e.has(u)&&!Lc(o,u,n,r))return!1}return 0===o.size}return!0}(e,t,n,o))return!1}else if(i===Pc){if(!function(e,t,n,r){for(var o=null,i=Xs(e),a=0;a<i.length;a++){var s=Ic(i[a],2),c=s[0],l=s[1];if("object"===jc(c)&&null!==c)null===o&&(o=new Set),o.add(c);else{var u=t.get(c);if(void 0===u&&!t.has(c)||!Fc(l,u,n,r)){if(n)return!1;if(!Dc(e,t,c,l,r))return!1;null===o&&(o=new Set),o.add(c)}}}if(null!==o){for(var d=Xs(t),p=0;p<d.length;p++){var f=Ic(d[p],2),y=(c=f[0],f[1]);if("object"===jc(c)&&null!==c){if(!_c(o,e,c,y,n,r))return!1}else if(!(n||e.has(c)&&Fc(e.get(c),y,!1,r)||_c(o,e,c,y,!1,r)))return!1}return 0===o.size}return!0}(e,t,n,o))return!1}else if(i===Ec)for(;a<e.length;a++){if(!ec(e,a)){if(ec(t,a))return!1;for(var s=Object.keys(e);a<s.length;a++){var c=s[a];if(!ec(t,c)||!Fc(e[c],t[c],n,o))return!1}return s.length===Object.keys(t).length}if(!ec(t,a)||!Fc(e[a],t[a],n,o))return!1}for(a=0;a<r.length;a++){var l=r[a];if(!Fc(e[l],t[l],n,o))return!1}return!0}function qc(e,t){return Fc(e,t,wc)}function Wc(e,t){return Fc(e,t,vc)}function zc(){return Oc||(Oc=!0,Gs={},Js=void 0!==/a/g.flags,Ys=function(e){var t=[];return e.forEach((function(e){return t.push(e)})),t},Xs=function(e){var t=[];return e.forEach((function(e,n){return t.push([n,e])})),t},Ks=Object.is?Object.is:Is(),Qs=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},Zs=Number.isNaN?Number.isNaN:$s(),ec=xc(Object.prototype.hasOwnProperty),tc=xc(Object.prototype.propertyIsEnumerable),nc=xc(Object.prototype.toString),rc=Zo().types,oc=rc.isAnyArrayBuffer,ic=rc.isArrayBufferView,ac=rc.isDate,sc=rc.isMap,cc=rc.isRegExp,lc=rc.isSet,uc=rc.isNativeError,dc=rc.isBoxedPrimitive,pc=rc.isNumberObject,fc=rc.isStringObject,yc=rc.isBooleanObject,hc=rc.isBigIntObject,gc=rc.isSymbolObject,mc=rc.isFloat32Array,bc=rc.isFloat64Array,void 0,vc=!0,wc=!1,Sc=0,Ec=1,Ac=2,Pc=3,Gs={isDeepEqual:qc,isDeepStrictEqual:Wc}),Gs}var Hc,Vc,$c,Gc,Jc,Yc,Xc,Kc,Qc,Zc,el,tl,nl,rl,ol,il,al,sl,cl,ll,ul,dl,pl,fl=!1;function yl(e){return(yl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hl(){var e=zc();al=e.isDeepEqual,sl=e.isDeepStrictEqual}function gl(e){if(e.message instanceof Error)throw e.message;throw new Qc(e)}function ml(e,t,n,r,o){var i,a=arguments.length;if(0===a)i="Failed";else if(1===a)n=e,e=void 0;else{if(!1===ll){ll=!0;var s=Vc.emitWarning?Vc.emitWarning:console.warn.bind(console);s("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094")}2===a&&(r="!=")}if(n instanceof Error)throw n;var c={actual:e,expected:t,operator:void 0===r?"fail":r,stackStartFn:o||ml};void 0!==n&&(c.message=n);var l=new Qc(c);throw i&&(l.message=i,l.generatedMessage=!0),l}function bl(e,t,n,r){if(!n){var o=!1;if(0===t)o=!0,r="No value argument passed to `assert.ok()`";else if(r instanceof Error)throw r;var i=new Qc({actual:n,expected:!0,message:r,operator:"==",stackStartFn:e});throw i.generatedMessage=o,i}}function vl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];bl.apply(void 0,[vl,t.length].concat(t))}function wl(e,t,n){if(arguments.length<2)throw new Kc("actual","expected");void 0===al&&hl(),sl(e,t)&&gl({actual:e,expected:t,message:n,operator:"notDeepStrictEqual",stackStartFn:wl})}function Sl(e,t,n,r,o,i){if(!(n in e)||!sl(e[n],t[n])){if(!r){var a=new pl(e,o),s=new pl(t,o,e),c=new Qc({actual:a,expected:s,operator:"deepStrictEqual",stackStartFn:i});throw c.actual=e,c.expected=t,c.operator=i.name,c}gl({actual:e,expected:t,message:r,operator:i.name,stackStartFn:i})}}function El(e,t,n,r){if("function"!=typeof t){if(rl(t))return t.test(e);if(2===arguments.length)throw new Jc("expected",["Function","RegExp"],t);if("object"!==yl(e)||null===e){var o=new Qc({actual:e,expected:t,message:n,operator:"deepStrictEqual",stackStartFn:r});throw o.operator=r.name,o}var i=Object.keys(t);if(t instanceof Error)i.push("name","message");else if(0===i.length)throw new Yc("error",t,"may not be an empty object");return void 0===al&&hl(),i.forEach((function(o){"string"==typeof e[o]&&rl(t[o])&&t[o].test(e[o])||Sl(e,t,o,n,i,r)})),!0}return void 0!==t.prototype&&e instanceof t||!Error.isPrototypeOf(t)&&!0===t.call({},e)}function Al(e){if("function"!=typeof e)throw new Jc("fn","Function",e);try{e()}catch(e){return e}return dl}function Pl(e){return nl(e)||null!==e&&"object"===yl(e)&&"function"==typeof e.then&&"function"==typeof e.catch}function Ol(e){return Promise.resolve().then((function(){var t;if("function"==typeof e){if(!Pl(t=e()))throw new Xc("instance of Promise","promiseFn",t)}else{if(!Pl(e))throw new Jc("promiseFn",["Function","Promise"],e);t=e}return Promise.resolve().then((function(){return t})).then((function(){return dl})).catch((function(e){return e}))}))}function Il(e,t,n,r){if("string"==typeof n){if(4===arguments.length)throw new Jc("error",["Object","Error","Function","RegExp"],n);if("object"===yl(t)&&null!==t){if(t.message===n)throw new Gc("error/message",'The error message "'.concat(t.message,'" is identical to the message.'))}else if(t===n)throw new Gc("error/message",'The error "'.concat(t,'" is identical to the message.'));r=n,n=void 0}else if(null!=n&&"object"!==yl(n)&&"function"!=typeof n)throw new Jc("error",["Object","Error","Function","RegExp"],n);if(t===dl){var o="";n&&n.name&&(o+=" (".concat(n.name,")")),o+=r?": ".concat(r):".";var i="rejects"===e.name?"rejection":"exception";gl({actual:void 0,expected:n,operator:e.name,message:"Missing expected ".concat(i).concat(o),stackStartFn:e})}if(n&&!El(t,n,r,e))throw t}function jl(e,t,n,r){if(t!==dl){if("string"==typeof n&&(r=n,n=void 0),!n||El(t,n)){var o=r?": ".concat(r):".",i="doesNotReject"===e.name?"rejection":"exception";gl({actual:t,expected:n,operator:e.name,message:"Got unwanted ".concat(i).concat(o,"\n")+'Actual message: "'.concat(t&&t.message,'"'),stackStartFn:e})}throw t}}function xl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];bl.apply(void 0,[xl,t.length].concat(t))}function Tl(){Hc={},Vc=j(),$c=x.codes,Gc=$c.ERR_AMBIGUOUS_ARGUMENT,Jc=$c.ERR_INVALID_ARG_TYPE,Yc=$c.ERR_INVALID_ARG_VALUE,Xc=$c.ERR_INVALID_RETURN_VALUE,Kc=$c.ERR_MISSING_ARGS,Qc=ti,Zc=Zo(),el=Zc.inspect,tl=Zo().types,nl=tl.isPromise,rl=tl.isRegExp,ol=Object.assign?Object.assign:Ti().assign,il=Object.is?Object.is:Is(),new Map,/[\x00-\x08\x0b\x0c\x0e-\x1f]/g,cl=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","","","\\u000b","\\f","","\\u000e","\\u000f","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001a","\\u001b","\\u001c","\\u001d","\\u001e","\\u001f"],function(e){return cl[e.charCodeAt(0)]},ll=!1,ul=Hc=vl,dl={},ul.fail=ml,ul.AssertionError=Qc,ul.ok=vl,ul.equal=function e(t,n,r){if(arguments.length<2)throw new Kc("actual","expected");t!=n&&gl({actual:t,expected:n,message:r,operator:"==",stackStartFn:e})},ul.notEqual=function e(t,n,r){if(arguments.length<2)throw new Kc("actual","expected");t==n&&gl({actual:t,expected:n,message:r,operator:"!=",stackStartFn:e})},ul.deepEqual=function e(t,n,r){if(arguments.length<2)throw new Kc("actual","expected");void 0===al&&hl(),al(t,n)||gl({actual:t,expected:n,message:r,operator:"deepEqual",stackStartFn:e})},ul.notDeepEqual=function e(t,n,r){if(arguments.length<2)throw new Kc("actual","expected");void 0===al&&hl(),al(t,n)&&gl({actual:t,expected:n,message:r,operator:"notDeepEqual",stackStartFn:e})},ul.deepStrictEqual=function e(t,n,r){if(arguments.length<2)throw new Kc("actual","expected");void 0===al&&hl(),sl(t,n)||gl({actual:t,expected:n,message:r,operator:"deepStrictEqual",stackStartFn:e})},ul.notDeepStrictEqual=wl,ul.strictEqual=function e(t,n,r){if(arguments.length<2)throw new Kc("actual","expected");il(t,n)||gl({actual:t,expected:n,message:r,operator:"strictEqual",stackStartFn:e})},ul.notStrictEqual=function e(t,n,r){if(arguments.length<2)throw new Kc("actual","expected");il(t,n)&&gl({actual:t,expected:n,message:r,operator:"notStrictEqual",stackStartFn:e})},pl=function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n.forEach((function(e){e in t&&(void 0!==r&&"string"==typeof r[e]&&rl(t[e])&&t[e].test(r[e])?o[e]=r[e]:o[e]=t[e])}))},ul.throws=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];Il.apply(void 0,[e,Al(t)].concat(r))},ul.rejects=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return Ol(t).then((function(t){return Il.apply(void 0,[e,t].concat(r))}))},ul.doesNotThrow=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];jl.apply(void 0,[e,Al(t)].concat(r))},ul.doesNotReject=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return Ol(t).then((function(t){return jl.apply(void 0,[e,t].concat(r))}))},ul.ifError=function e(t){if(null!=t){var n="ifError got unwanted exception: ";"object"===yl(t)&&"string"==typeof t.message?0===t.message.length&&t.constructor?n+=t.constructor.name:n+=t.message:n+=el(t);var r=new Qc({actual:t,expected:null,operator:"ifError",message:n,stackStartFn:e}),o=t.stack;if("string"==typeof o){var i=o.split("\n");i.shift();for(var a=r.stack.split("\n"),s=0;s<i.length;s++){var c=a.indexOf(i[s]);if(-1!==c){a=a.slice(0,c);break}}r.stack="".concat(a.join("\n"),"\n").concat(i.join("\n"))}throw r}},ul.strict=ol(xl,ul,{equal:ul.strictEqual,deepEqual:ul.deepStrictEqual,notEqual:ul.notStrictEqual,notDeepEqual:ul.notDeepStrictEqual}),ul.strict.strict=ul.strict}function kl(){return fl||(fl=!0,Tl()),Hc}let Rl=kl();async function Fl(e,t){t||(t=[]);let n=await e;return t=n.entries.concat(t),n.next?Fl(n.next(),t):t}async function Nl(e,t,n){let r=await Fl(e.get({order:t}));Rl.deepStrictEqual(r,n)}async function Ml(e,t){await Promise.all([Nl(e,"created",t),Nl(e,"added",t)])}async function Ll(e,t){let n=await e.getLastAdded();Rl.strictEqual(n,t)}async function Ul(e,t,n){let r=await e.getLastSynced();Rl.deepStrictEqual(r,{sent:t,received:n})}u={eachStoreCheck:function(e){e("is empty in the beginning",(e=>async()=>{let t=e();await Promise.all([Ll(t,0),Ul(t,0,0)])})),e("updates latest synced values",(e=>async()=>{let t=e();await t.setLastSynced({sent:1}),await Ul(t,1,0),await t.setLastSynced({received:1}),await Ul(t,1,1)})),e("updates both synced values",(e=>async()=>{let t=e();await t.setLastSynced({sent:2,received:1}),await Ul(t,2,1)})),e("stores entries sorted",(e=>async()=>{let t=e();await Promise.all([t.add({type:"1"},{id:"1 a 0",time:1}),t.add({type:"2"},{id:"1 c 0",time:2}),t.add({type:"3"},{id:"1 b 1",time:2}),t.add({type:"4"},{id:"3 b 0",time:2})]),await Nl(t,"created",[[{type:"1"},{added:1,id:"1 a 0",time:1}],[{type:"4"},{added:4,id:"3 b 0",time:2}],[{type:"3"},{added:3,id:"1 b 1",time:2}],[{type:"2"},{added:2,id:"1 c 0",time:2}]]),await Nl(t,"added",[[{type:"1"},{added:1,id:"1 a 0",time:1}],[{type:"2"},{added:2,id:"1 c 0",time:2}],[{type:"3"},{added:3,id:"1 b 1",time:2}],[{type:"4"},{added:4,id:"3 b 0",time:2}]])})),e("returns latest added",(e=>async()=>{let t=e();await t.add({type:"A"},{id:"1 n 0",time:1});let n=await t.getLastAdded();Rl.ok(n),await t.add({type:"A"},{id:"1 n 0"}),await Ll(t,1)})),e("changes meta",(e=>async()=>{let t=e();await t.add({},{id:"1 n 0",time:1,a:1});let n=await t.changeMeta("1 n 0",{a:2,b:2});Rl.strictEqual(n,!0),await Ml(t,[[{},{id:"1 n 0",time:1,added:1,a:2,b:2}]])})),e("resolves to false on unknown ID in changeMeta",(e=>async()=>{let t=e(),n=await t.changeMeta("1 n 0",{a:1});Rl.strictEqual(n,!1)})),e("removes entries",(e=>async()=>{let t=e();await Promise.all([t.add({type:"1"},{id:"1 node1 0",time:1}),t.add({type:"1"},{id:"1 node1 0",time:1}),t.add({type:"2"},{id:"1 node1 1",time:2}),t.add({type:"3"},{id:"1 node1 2",time:2}),t.add({type:"4"},{id:"1 node1 3",time:2}),t.add({type:"5"},{id:"1 node2 0",time:2}),t.add({type:"6"},{id:"4 node1 0",time:4})]);let n=await t.remove("1 node1 1");Rl.deepStrictEqual(n,[{type:"2"},{id:"1 node1 1",time:2,added:2}]),await Ml(t,[[{type:"1"},{id:"1 node1 0",time:1,added:1}],[{type:"3"},{id:"1 node1 2",time:2,added:3}],[{type:"4"},{id:"1 node1 3",time:2,added:4}],[{type:"5"},{id:"1 node2 0",time:2,added:5}],[{type:"6"},{id:"4 node1 0",time:4,added:6}]])})),e("removes entry with 0 time",(e=>async()=>{let t=e();await Promise.all([t.add({type:"1"},{id:"1 node1 0",time:1}),t.add({type:"2"},{id:"2 node1 0",time:2}),t.add({type:"3"},{id:"3 node1 0",time:0})]),await t.remove("3 node1 0"),await Ml(t,[[{type:"1"},{id:"1 node1 0",time:1,added:1}],[{type:"2"},{id:"2 node1 0",time:2,added:2}]])})),e("ignores removing unknown entry",(e=>async()=>{let t=e();await t.add({type:"A"},{id:"1 n 0",time:1,added:1});let n=await t.remove("2 n 0");Rl.strictEqual(n,!1),await Nl(t,"created",[[{type:"A"},{id:"1 n 0",time:1,added:1}]])})),e("removes reasons and actions without reason",(e=>async()=>{let t=e(),n=[];await Promise.all([t.add({type:"1"},{id:"1 n 0",time:1,reasons:["a"]}),t.add({type:"2"},{id:"2 n 0",time:2,reasons:["a"]}),t.add({type:"3"},{id:"3 n 0",time:3,reasons:["a","b"]}),t.add({type:"4"},{id:"4 n 0",time:4,reasons:["b"]})]),await t.removeReason("a",{},((e,t)=>{n.push([e,t])})),await Ml(t,[[{type:"3"},{added:3,id:"3 n 0",time:3,reasons:["b"]}],[{type:"4"},{added:4,id:"4 n 0",time:4,reasons:["b"]}]])})),e("removes reason by time",(e=>async()=>{let t=e();await Promise.all([t.add({type:"1"},{id:"1 n 0",time:1,reasons:["a"]}),t.add({type:"2"},{id:"2 n 0",time:2,reasons:["a"]}),t.add({type:"3"},{id:"3 n 0",time:3,reasons:["a"]})]);await t.removeReason("a",{olderThan:{id:"3 n 0",time:3},youngerThan:{id:"1 n 0",time:1}},(()=>{})),await Ml(t,[[{type:"1"},{added:1,id:"1 n 0",time:1,reasons:["a"]}],[{type:"3"},{added:3,id:"3 n 0",time:3,reasons:["a"]}]])})),e("removes reason for older action",(e=>async()=>{let t=e();await Promise.all([t.add({type:"1"},{id:"1 n 0",time:1,reasons:["a"]}),t.add({type:"2"},{id:"2 n 0",time:2,reasons:["a"]}),t.add({type:"3"},{id:"3 n 0",time:3,reasons:["a"]})]);await t.removeReason("a",{olderThan:{id:"2 n 0",time:2}},(()=>{})),await Ml(t,[[{type:"2"},{added:2,id:"2 n 0",time:2,reasons:["a"]}],[{type:"3"},{added:3,id:"3 n 0",time:3,reasons:["a"]}]])})),e("removes reason for younger action",(e=>async()=>{let t=e();await Promise.all([t.add({type:"1"},{id:"1 n 0",time:1,reasons:["a"]}),t.add({type:"2"},{id:"2 n 0",time:2,reasons:["a"]}),t.add({type:"3"},{id:"3 n 0",time:3,reasons:["a"]})]);await t.removeReason("a",{youngerThan:{id:"2 n 0",time:2}},(()=>{})),await Ml(t,[[{type:"1"},{added:1,id:"1 n 0",time:1,reasons:["a"]}],[{type:"2"},{added:2,id:"2 n 0",time:2,reasons:["a"]}]])})),e("removes reason with minimum added",(e=>async()=>{let t=e();await Promise.all([t.add({type:"1"},{id:"1 n 0",time:1,reasons:["a"]}),t.add({type:"2"},{id:"2 n 0",time:2,reasons:["a"]}),t.add({type:"3"},{id:"3 n 0",time:3,reasons:["a"]})]),await t.removeReason("a",{minAdded:2},(()=>{})),await Ml(t,[[{type:"1"},{added:1,id:"1 n 0",time:1,reasons:["a"]}]])})),e("removes reason with maximum added",(e=>async()=>{let t=e();await Promise.all([t.add({type:"1"},{id:"1 n 0",time:1,reasons:["a"]}),t.add({type:"2"},{id:"2 n 0",time:2,reasons:["a"]}),t.add({type:"3"},{id:"3 n 0",time:3,reasons:["a"]})]),await t.removeReason("a",{maxAdded:2},(()=>{})),await Ml(t,[[{type:"3"},{added:3,id:"3 n 0",time:3,reasons:["a"]}]])})),e("removes reason with minimum and maximum added",(e=>async()=>{let t=e();await Promise.all([t.add({type:"1"},{id:"1 n 0",time:1,reasons:["a"]}),t.add({type:"2"},{id:"2 n 0",time:2,reasons:["a"]}),t.add({type:"3"},{id:"3 n 0",time:3,reasons:["a"]})]),await t.removeReason("a",{maxAdded:2,minAdded:2},(()=>{})),await Ml(t,[[{type:"1"},{added:1,id:"1 n 0",time:1,reasons:["a"]}],[{type:"3"},{added:3,id:"3 n 0",time:3,reasons:["a"]}]])})),e("removes reason with zero at maximum added",(e=>async()=>{let t=e();await t.add({},{id:"1 n 0",time:1,reasons:["a"]}),await t.removeReason("a",{maxAdded:0},(()=>{})),await Ml(t,[[{},{added:1,id:"1 n 0",time:1,reasons:["a"]}]])})),e("removes reasons and actions by id",(e=>async()=>{let t=e(),n=[];function r(e){n.push(e.type)}await Promise.all([t.add({type:"1"},{id:"1 n 0",time:1,reasons:["a"]}),t.add({type:"2"},{id:"2 n 0",time:2,reasons:["a","b"]}),t.add({type:"3"},{id:"3 n 0",time:3,reasons:["a"]})]),await Promise.all([t.removeReason("a",{id:"1 n 0"},r),t.removeReason("b",{id:"2 n 0"},r),t.removeReason("c",{id:"3 n 0"},r),t.removeReason("a",{id:"4 n 0"},r)]),Rl.deepStrictEqual(n,["1"]),await Ml(t,[[{type:"2"},{added:2,id:"2 n 0",time:2,reasons:["a"]}],[{type:"3"},{added:3,id:"3 n 0",time:3,reasons:["a"]}]])})),e("returns action by ID",(e=>async()=>{let t=e();await Promise.all([t.add({type:"A"},{id:"1 node 0",time:1}),t.add({type:"B"},{id:"1 node 1",time:2}),t.add({type:"C"},{id:"1 node 2",time:2}),t.add({type:"D"},{id:"1 node 3",time:2}),t.add({type:"E"},{id:"2 node 0",time:2})]);let[n,r]=await t.byId("1 node 0");Rl.deepStrictEqual(n,{type:"A"}),Rl.deepStrictEqual(r.time,1);let[o]=await t.byId("1 node 2");Rl.deepStrictEqual(o,{type:"C"});let[i,a]=await t.byId("2 node 1");Rl.deepStrictEqual(i,null),Rl.deepStrictEqual(a,null)})),e("ignores entries with same ID",(e=>async()=>{let t=e(),n="1 a 1",r=await t.add({a:1},{id:n,time:1});Rl.deepStrictEqual(r,{id:n,time:1,added:1});let o=await t.add({a:2},{id:n,time:2});Rl.ok(!o),await Ml(t,[[{a:1},{id:n,time:1,added:1}]])})),e("stores any metadata",(e=>async()=>{let t=e();await t.add({type:"A"},{id:"1 a 0",time:1,test:1}),await Ml(t,[[{type:"A"},{added:1,id:"1 a 0",time:1,test:1}]])})),e("sorts actions with same time",(e=>async()=>{let t=e();await Promise.all([t.add({type:"B"},{id:"2 a 0",time:1}),t.add({type:"C"},{id:"3 a 0",time:1}),t.add({type:"A"},{id:"1 a 0",time:1})]),await Nl(t,"created",[[{type:"A"},{added:3,id:"1 a 0",time:1}],[{type:"B"},{added:1,id:"2 a 0",time:1}],[{type:"C"},{added:2,id:"3 a 0",time:1}]])})),e("cleans whole store if implemented",(e=>async()=>{let t=e();await Promise.all([t.add({type:"A"},{id:"1",time:1}),t.add({type:"B"},{id:"2",time:2}),t.add({type:"C"},{id:"3",time:3}),t.add({type:"D"},{id:"4",time:4}),t.add({type:"E"},{id:"5",time:5})]),await t.clean();let n=e();await Promise.all([Ml(n,[]),Ll(n,0),Ul(n,0,0)])}))}};let{eachStoreCheck:Cl}=u;var Dl;Dl={isFirstOlder:function(e,t){if(e&&!t)return!1;if(!e&&t)return!0;if(e.time>t.time)return!1;if(e.time<t.time)return!0;let n=e.id.split(" "),r=t.id.split(" "),o=n[1],i=r[1];if(o>i)return!1;if(o<i)return!0;let a=parseInt(n[2]),s=parseInt(r[2]);if(a>s)return!1;if(a<s)return!0;let c=parseInt(n[0]),l=parseInt(r[0]);return!(c>l)&&c<l}};let{isFirstOlder:_l}=Dl,{WsConnection:Bl}=i;var ql;let{isFirstOlder:Wl}=Dl;function zl(e,t){return e.lastAdded+=1,t[1].added=e.lastAdded,e.added.push(t),Promise.resolve(t[1])}function Hl(e,t){for(let n=e.length-1;n>=0;n--)if(t===e[n][1].id)return n;return-1}function Vl(e){return void 0!==e}ql={MemoryStore:class{constructor(){this.entries=[],this.added=[],this.lastReceived=0,this.lastAdded=0,this.lastSent=0}async add(e,t){let n=[e,t],r=t.id,o=this.entries;for(let e=0;e<o.length;e++){let[,i]=o[e];if(r===i.id)return!1;if(!Wl(i,t))return o.splice(e,0,n),zl(this,n)}return o.push(n),zl(this,n)}async byId(e){let t=Hl(this.entries,e);if(-1===t)return[null,null];{let[e,n]=this.entries[t];return[e,n]}}async remove(e,t){if(void 0===t&&-1===(t=Hl(this.entries,e)))return Promise.resolve(!1);let n=[this.entries[t][0],this.entries[t][1]];this.entries.splice(t,1);let r=n[1].added,o=0,i=this.added.length-1;for(;o<=i;){let e=i+o>>1,t=this.added[e][1].added;if(t<r)o=e+1;else{if(!(t>r)){this.added.splice(e,1);break}i=e-1}}return n}async get(e={}){let t;return t="created"===e.order?this.entries:this.added,{entries:t.slice(0)}}async changeMeta(e,t){let n=Hl(this.entries,e);if(-1===n)return!1;{let e=this.entries[n][1];for(let n in t)e[n]=t[n];return!0}}async removeReason(e,t,n){let r=[];if(t.id){let r=Hl(this.entries,t.id);if(-1!==r){let o=this.entries[r][1],i=o.reasons.indexOf(e);-1!==i&&(o.reasons.splice(i,1),0===o.reasons.length&&(n(this.entries[r][0],o),this.remove(t.id)))}}else this.entries=this.entries.filter((([o,i])=>{let a=t,s=i.reasons.indexOf(e);return-1===s||(!(!Vl(a.olderThan)||Wl(i,a.olderThan))||(!(!Vl(a.youngerThan)||Wl(a.youngerThan,i))||(!!(Vl(a.minAdded)&&i.added<a.minAdded)||(!!(Vl(a.maxAdded)&&i.added>a.maxAdded)||(i.reasons.splice(s,1),0!==i.reasons.length||(n(o,i),r.push(i.added),!1))))))})),this.added=this.added.filter((e=>!r.includes(e[1].added)))}async clean(){this.entries=[],this.added=[],this.lastReceived=0,this.lastAdded=0,this.lastSent=0}async getLastAdded(){return this.lastAdded}async getLastSynced(){return{received:this.lastReceived,sent:this.lastSent}}async setLastSynced(e){void 0!==e.sent&&(this.lastSent=e.sent),void 0!==e.received&&(this.lastReceived=e.received)}}};let{MemoryStore:$l}=ql;var Gl,Jl,Yl,Xl;class Kl extends Error{static describe(e,t){return"timeout"===e?"A timeout was reached ("+t+" ms)":"wrong-format"===e?"Wrong message format in "+t:"unknown-message"===e?"Unknown message `"+t+"` type":"bruteforce"===e?"Too many wrong authentication attempts":"wrong-protocol"===e?"Logux supports protocols only from version "+t.supported+", but you use "+t.used:"wrong-subprotocol"===e?`Only ${t.supported} application subprotocols are supported, but you use `+t.used:"wrong-credentials"===e?"Wrong credentials":e}constructor(e,t,n){super(e),this.name="LoguxError",this.type=e,this.options=t,this.description=Kl.describe(e,t),this.received=!!n,n?(this.message="Logux received "+this.type+" error",this.description!==this.type&&(this.message+=" ("+this.description+")")):this.message=this.description,Error.captureStackTrace&&Error.captureStackTrace(this,Kl)}}Xl={LoguxError:Kl};let{LoguxError:Ql}=Xl;async function Zl(e,t,n,r){if(!e.options.auth)return e.authenticated=!0,void r();try{if(await e.options.auth(t,n,e.remoteHeaders)){e.authenticated=!0,r();for(let t=0;t<e.unauthenticated.length;t++)e.onMessage(e.unauthenticated[t]);e.unauthenticated=[]}else e.sendError(new Ql("wrong-credentials")),e.destroy()}catch(t){"LoguxError"===t.name?(e.sendError(t),e.destroy()):e.error(t)}}function eu(e,t){return e.remoteProtocol=t,t>=e.minProtocol||(e.sendError(new Ql("wrong-protocol",{supported:e.minProtocol,used:t})),e.destroy(),!1)}function tu(e){try{e.emitter.emit("connect")}catch(t){if("LoguxError"===t.name)return e.sendError(t),!1;throw t}return!0}Yl={sendConnect:async function(){let e=["connect",this.localProtocol,this.localNodeId,this.lastReceived],t={};this.options.token&&("function"==typeof this.options.token?t.token=await this.options.token():t.token=this.options.token),this.options.subprotocol&&(t.subprotocol=this.options.subprotocol),Object.keys(t).length>0&&e.push(t),this.options.fixTime&&(this.connectSended=this.now()),Object.keys(this.localHeaders).length>0&&this.sendHeaders(this.localHeaders),this.startTimeout(),this.send(e)},sendConnected:async function(e,t){let n=["connected",this.localProtocol,this.localNodeId,[e,t]],r={};this.options.token&&("function"==typeof this.options.token?r.token=await this.options.token():r.token=this.options.token),this.options.subprotocol&&(r.subprotocol=this.options.subprotocol),Object.keys(r).length>0&&n.push(r),Object.keys(this.localHeaders).length>0&&this.sendHeaders(this.localHeaders),this.send(n)},connectMessage:function(e,t,n,r){let o=this.now();r||(r={}),this.remoteNodeId=t,eu(this,e)&&(this.remoteSubprotocol=r.subprotocol||"0.0.0",tu(this)?Zl(this,t,r.token,(()=>{this.baseTime=this.now(),this.sendConnected(o,this.baseTime),this.syncSince(n)})):this.destroy())},connectedMessage:function(e,t,n,r){if(r||(r={}),this.endTimeout(),this.remoteNodeId=t,eu(this,e)){if(this.baseTime=n[1],this.options.fixTime){let e=this.now(),t=n[1]-n[0],r=e-this.connectSended-t;this.timeFix=Math.floor(this.connectSended-n[0]+r/2)}this.remoteSubprotocol=r.subprotocol||"0.0.0",tu(this)?Zl(this,t,r.token,(()=>{this.syncSince(this.lastSent)})):this.destroy()}}};let{sendConnect:nu,sendConnected:ru,connectMessage:ou,connectedMessage:iu}=Yl;var au;au={sendSync:function(e,t){this.startTimeout();let n=[];for(let[e,r]of t){let t={};for(let e in r)"id"===e?t.id=r.id.split(" "):"added"!==e&&(t[e]=r[e]);this.timeFix&&(t.time-=this.timeFix),t.id[0]=parseInt(t.id[0])-this.baseTime,t.id[2]=parseInt(t.id[2]),t.time-=this.baseTime,t.id[1]===this.localNodeId&&(0===t.id[2]?t.id=t.id[0]:t.id=[t.id[0],t.id[2]]),n.unshift(e,t)}this.syncing+=1,this.setState("sending"),this.send(["sync",e].concat(n))},sendSynced:function(e){this.send(["synced",e])},syncMessage:async function(e,...t){let n=[];for(let e=0;e<t.length-1;e+=2){let r=t[e],o=t[e+1];"number"==typeof o.id?o.id=o.id+this.baseTime+" "+this.remoteNodeId+" 0":(o.id[0]=o.id[0]+this.baseTime,2===o.id.length?o.id=o.id[0]+" "+this.remoteNodeId+" "+o.id[1]:o.id=o.id.join(" ")),o.time=o.time+this.baseTime,this.timeFix&&(o.time=o.time+this.timeFix);let i=Promise.resolve([r,o]);this.options.inMap&&(i=i.then((([e,t])=>this.options.inMap(e,t))).catch((e=>{this.error(e)}))),i.then((e=>e&&this.options.inFilter?this.options.inFilter(...e).then((t=>!!t&&e)).catch((e=>{this.error(e)})):e)).then((e=>!!e&&(this.received&&(this.received[e[1].id]=!0),this.log.add(e[0],e[1])))),n.push(i)}await Promise.all(n),this.setLastReceived(e),this.sendSynced(e)},syncedMessage:function(e){this.endTimeout(),this.setLastSent(e),this.syncing>0&&(this.syncing-=1),0===this.syncing&&this.setState("synchronized")}};let{sendSync:su,sendSynced:cu,syncMessage:lu,syncedMessage:uu}=au;var du;du={sendPing:function(){this.startTimeout(),this.send(["ping",this.lastAddedCache]),this.pingTimeout&&clearTimeout(this.pingTimeout)},pingMessage:function(e){this.setLastReceived(e),this.connected&&this.authenticated&&this.send(["pong",this.lastAddedCache])},pongMessage:function(e){this.setLastReceived(e),this.endTimeout()}};let{sendPing:pu,pingMessage:fu,pongMessage:yu}=du;var hu;hu={sendDebug:function(e,t){this.send(["debug",e,t])},debugMessage:function(e,t){this.emitter.emit("debug",e,t)}};let{sendDebug:gu,debugMessage:mu}=hu;var bu;bu={sendError:function(e){let t=["error",e.type];void 0!==e.options&&t.push(e.options),this.send(t),this.emitter.emit("clientError",e)},errorMessage:function(e,t){this.syncError(e,t,!0)}};let{sendError:vu,errorMessage:wu}=bu;var Su;Su={sendHeaders:function(e){this.send(["headers",e])},headersMessage:function(e){this.remoteHeaders=e,this.emitter.emit("headers",e)}};let{sendHeaders:Eu,headersMessage:Au}=Su,{LoguxError:Pu}=Xl;const Ou={"wrong-subprotocol":!0,"wrong-protocol":!0,timeout:!0},Iu=["connect","connected","error","debug","headers"];async function ju(e,t,n){let r=n.added;if(void 0===r){let t=e.lastAddedCache;r=t>e.lastSent?t:e.lastSent}if(e.options.outMap)try{let o=await e.options.outMap(t,n);e.sendSync(r,[o])}catch(t){e.error(t)}else e.sendSync(r,[[t,n]])}class xu{constructor(e,t,n,r={}){if(this.remoteNodeId=void 0,this.remoteProtocol=void 0,this.remoteSubprotocol=void 0,this.minProtocol=3,this.localProtocol=4,this.localNodeId=e,this.log=t,this.connection=n,this.options=r,this.options.ping&&!this.options.timeout)throw new Error("You must set timeout option to use ping");this.connected=!1,this.authenticated=!1,this.unauthenticated=[],this.timeFix=0,this.syncing=0,this.received={},this.lastSent=0,this.lastReceived=0,this.state="disconnected",this.emitter=s(),this.timeouts=[],this.throwsError=!0,this.unbind=[t.on("add",((e,t)=>{this.onAdd(e,t)})),n.on("connecting",(()=>{this.onConnecting()})),n.on("connect",(()=>{this.onConnect()})),n.on("message",(e=>{this.onMessage(e)})),n.on("error",(e=>{"Wrong message format"===e.message?(this.sendError(new Pu("wrong-format",e.received)),this.connection.disconnect("error")):this.error(e)})),n.on("disconnect",(()=>{this.onDisconnect()}))],this.initialized=!1,this.lastAddedCache=0,this.initializing=this.initialize(),this.localHeaders={},this.remoteHeaders={}}on(e,t){return this.emitter.on(e,t)}catch(e){this.throwsError=!1;let t=this.on("error",e);return()=>{this.throwsError=!0,t()}}waitFor(e){return this.state===e?Promise.resolve():new Promise((t=>{let n=this.on("state",(()=>{this.state===e&&(n(),t())}))}))}destroy(){this.connection.destroy?this.connection.destroy():this.connected&&this.connection.disconnect("destroy");for(let e of this.unbind)e();clearTimeout(this.pingTimeout),this.endTimeout()}setLocalHeaders(e){this.localHeaders=e,this.connected&&this.sendHeaders(e)}send(e){if(this.connected){this.delayPing();try{this.connection.send(e)}catch(e){this.error(e)}}}onConnecting(){this.setState("connecting")}onConnect(){this.delayPing(),this.connected=!0}onDisconnect(){for(;this.timeouts.length>0;)this.endTimeout();this.pingTimeout&&clearTimeout(this.pingTimeout),this.authenticated=!1,this.connected=!1,this.setState("disconnected")}onMessage(e){this.delayPing();let t=e[0];this.authenticated||Iu.includes(t)?this[t+"Message"](...e.slice(1)):this.unauthenticated.push(e)}async onAdd(e,t){if(this.authenticated)if(this.lastAddedCache<t.added&&(this.lastAddedCache=t.added),this.received&&this.received[t.id])delete this.received[t.id];else if(this.options.outFilter)try{await this.options.outFilter(e,t)&&ju(this,e,t)}catch(e){this.error(e)}else ju(this,e,t)}syncError(e,t,n){let r=new Pu(e,t,n);if(this.emitter.emit("error",r),!Ou[e]&&this.throwsError)throw r}error(e){if(this.emitter.emit("error",e),this.connection.disconnect("error"),this.throwsError)throw e}setState(e){this.state!==e&&(this.state=e,this.emitter.emit("state"))}startTimeout(){if(!this.options.timeout)return;let e=this.options.timeout,t=setTimeout((()=>{this.connected&&this.connection.disconnect("timeout"),this.syncError("timeout",e)}),e);this.timeouts.push(t)}endTimeout(){this.timeouts.length>0&&clearTimeout(this.timeouts.shift())}delayPing(){this.options.ping&&(this.pingTimeout&&clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout((()=>{this.connected&&this.authenticated&&this.sendPing()}),this.options.ping))}async syncSinceQuery(e){let t=[];await this.log.each({order:"added"},((n,r)=>!(r.added<=e)&&(this.options.outFilter?t.push(this.options.outFilter(n,r).then((e=>!!e&&[n,r])).catch((e=>{this.error(e)}))):t.push(Promise.resolve([n,r])),!0)));let n=await Promise.all(t),r={added:0};return r.entries=n.filter((e=>(e&&r.added<e[1].added&&(r.added=e[1].added),!1!==e))),r}async syncSince(e){let t=await this.syncSinceQuery(e);this.connected&&(t.entries.length>0?this.options.outMap?Promise.all(t.entries.map((e=>this.options.outMap(e[0],e[1])))).then((e=>{this.sendSync(t.added,e)})).catch((e=>{this.error(e)})):this.sendSync(t.added,t.entries):this.setState("synchronized"))}setLastSent(e){this.lastSent<e&&(this.lastSent=e,this.log.store.setLastSynced({sent:e}))}setLastReceived(e){this.lastReceived<e&&(this.lastReceived=e),this.log.store.setLastSynced({received:e})}now(){return Date.now()}async initialize(){let[e,t]=await Promise.all([this.log.store.getLastSynced(),this.log.store.getLastAdded()]);this.initialized=!0,this.lastSent=e.sent,this.lastReceived=e.received,this.lastAddedCache=t,this.connection.connected&&this.onConnect()}sendDuilian(){this.send(["duilian",Object.keys(Tu)[0]])}duilianMessage(e){Tu[e]&&this.send(["duilian",Tu[e]])}}xu.prototype.sendConnect=nu,xu.prototype.sendConnected=ru,xu.prototype.connectMessage=ou,xu.prototype.connectedMessage=iu,xu.prototype.sendSync=su,xu.prototype.sendSynced=cu,xu.prototype.syncMessage=lu,xu.prototype.syncedMessage=uu,xu.prototype.sendPing=pu,xu.prototype.pingMessage=fu,xu.prototype.pongMessage=yu,xu.prototype.sendDebug=gu,xu.prototype.debugMessage=mu,xu.prototype.sendError=vu,xu.prototype.errorMessage=wu,xu.prototype.sendHeaders=Eu,xu.prototype.headersMessage=Au;const Tu={"金木水火土":"板城烧锅酒"};Jl={BaseNode:xu};let{BaseNode:ku}=Jl;const Ru={fixTime:!0,timeout:2e4,ping:5e3};Gl={ClientNode:class extends ku{constructor(e,t,n,r={}){super(e,t,n,r={...Ru,...r})}onConnect(){this.connected||(this.connected=!0,this.initializing=this.initializing.then((()=>{this.connected&&this.sendConnect()})))}}};let{ClientNode:Fu}=Gl;var Nu;let{BaseNode:Mu}=Jl;var Lu;let{LoguxError:Uu}=Xl;function Cu(e){return"number"==typeof e}function Du(e){return"string"==typeof e}function _u(e){return"object"==typeof e&&"number"!=typeof e.length}function Bu(e){return Array.isArray(e)}function qu(e){return Bu(e)&&2===e.length&&Cu(e[0])&&Cu(e[1])}function Wu(e){return _u(e)&&Cu(e.time)&&(Cu(e.id)||qu(e.id)||function(e){return Bu(e)&&3===e.length&&Cu(e[0])&&Du(e[1])&&Cu(e[2])}(e.id))}let zu={connect:e=>Cu(e[1])&&Du(e[2])&&Cu(e[3])&&(4===e.length||5===e.length&&_u(e[4])),connected:e=>Cu(e[1])&&Du(e[2])&&qu(e[3])&&(4===e.length||5===e.length&&_u(e[4])),ping:e=>2===e.length&&Cu(e[1]),pong:e=>2===e.length&&Cu(e[1]),sync(e){if(!Cu(e[1]))return!1;if(e.length%2!=0)return!1;for(let t=2;t<e.length;t++)if(t%2==0){if(!_u(e[t])||!Du(e[t].type))return!1}else if(!Wu(e[t]))return!1;return!0},synced:e=>2===e.length&&Cu(e[1]),error:e=>(2===e.length||3===e.length)&&Du(e[1]),duilian:e=>2===e.length&&Du(e[1]),debug:e=>3===e.length&&Du(e[1])&&"error"===e[1]&&Du(e[2]),headers:e=>2===e.length&&_u(e[1])};function Hu(e,t){return e.sendError(new Uu("wrong-format",JSON.stringify(t))),e.connection.disconnect("error"),!1}Lu={validate:function(e,t){if(!Bu(t))return Hu(e,t);let n=t[0];if(!Du(n))return Hu(e,t);let r=zu[n];return r&&e[n+"Message"]?!!r(t)||Hu(e,t):(e.sendError(new Uu("unknown-message",n)),e.connection.disconnect("error"),!1)}};let{validate:Vu}=Lu;const $u={timeout:2e4,ping:1e4};Nu={ServerNode:class extends Mu{constructor(e,t,n,r={}){if(super(e,t,n,r={...$u,...r}),this.options.fixTime)throw new Error("Logux Server could not fix time. Set opts.fixTime for Client node.");this.state="connecting"}onConnect(){this.initialized&&(super.onConnect(),this.startTimeout())}onDisconnect(){super.onDisconnect(),this.destroy()}onMessage(e){Vu(this,e)&&super.onMessage(e)}async connectMessage(...e){await this.initializing,super.connectMessage(...e),this.endTimeout()}async initialize(){let e=await this.log.store.getLastAdded();this.initialized=!0,this.lastAddedCache=e,this.connection.connected&&this.onConnect()}}};let{ServerNode:Gu}=Nu,{LoguxError:Ju}=Xl;var Yu;class Xu{constructor(e,t){this.connected=!1,this.emitter=s(),this.type=t,this.pair=e}other(){return"left"===this.type?this.pair.right:this.pair.left}on(e,t){return this.emitter.on(e,t)}connect(){if(this.connected)throw new Error("Connection already established");return this.emitter.emit("connecting"),new Promise((e=>{setTimeout((()=>{this.other().connected=!0,this.connected=!0,this.other().emitter.emit("connect"),this.emitter.emit("connect"),e()}),this.pair.delay)}))}disconnect(e){if(this.connected)return this.connected=!1,this.emitter.emit("disconnect",e),new Promise((e=>{setTimeout((()=>{this.other().connected=!1,this.other().emitter.emit("disconnect"),e()}),1)}));throw new Error("Connection already finished")}send(e){if(!this.connected)throw new Error("Connection should be started before sending a message");setTimeout((()=>{this.other().emitter.emit("message",e)}),this.pair.delay)}}Yu={LocalPair:class{constructor(e=1){this.delay=e,this.left=new Xu(this,"left"),this.right=new Xu(this,"right")}}};let{LocalPair:Ku}=Yu;var Qu;const Zu={minDelay:1e3,maxDelay:5e3,attempts:1/0},ed=["wrong-protocol","wrong-subprotocol","wrong-credentials"];Qu={Reconnect:class{constructor(e,t={}){this.connection=e,this.options={...Zu,...t},this.reconnecting=e.connected,this.connecting=!1,this.attempts=0,this.unbind=[this.connection.on("message",(e=>{"error"===e[0]&&ed.includes(e[1])&&(this.reconnecting=!1)})),this.connection.on("connecting",(()=>{this.connecting=!0})),this.connection.on("connect",(()=>{this.attempts=0,this.connecting=!1})),this.connection.on("disconnect",(()=>{this.connecting=!1,this.reconnecting&&this.reconnect()})),()=>{clearTimeout(this.timer)}];let n=()=>{!this.reconnecting||this.connected||this.connecting||"undefined"==typeof document||document.hidden||this.connect()},r=()=>{!this.reconnecting||this.connected||this.connecting||navigator.onLine&&this.connect()},o=()=>{this.disconnect("freeze")};"undefined"!=typeof document&&"undefined"!=typeof window&&document.addEventListener&&window.addEventListener&&(document.addEventListener("visibilitychange",n,!1),window.addEventListener("focus",r,!1),window.addEventListener("online",r,!1),window.addEventListener("resume",r,!1),window.addEventListener("freeze",o,!1),this.unbind.push((()=>{document.removeEventListener("visibilitychange",n,!1),window.removeEventListener("focus",r,!1),window.removeEventListener("online",r,!1),window.removeEventListener("resume",r,!1),window.removeEventListener("freeze",o,!1)})))}connect(){return this.attempts+=1,this.reconnecting=!0,this.connection.connect()}disconnect(e){return"timeout"!==e&&"error"!==e&&"freeze"!==e&&(this.reconnecting=!1),this.connection.disconnect(e)}destroy(){for(let e of this.unbind)e();this.disconnect("destroy")}reconnect(){if(this.attempts>this.options.attempts-1)return this.reconnecting=!1,void(this.attempts=0);let e=this.nextDelay();this.timer=setTimeout((()=>{!this.reconnecting||this.connecting||this.connected||this.connect()}),e)}send(...e){return this.connection.send(...e)}on(...e){return this.connection.on(...e)}nextDelay(){let e=this.options.minDelay*2**this.attempts,t=Math.random(),n=Math.floor(.5*t*e);return 1===Math.floor(10*t)&&(n=-n),Math.min(e+n,this.options.maxDelay)||0}get connected(){return this.connection.connected}get emitter(){return this.connection.emitter}}};let{Reconnect:td}=Qu;var nd,rd;let{MemoryStore:od}=ql;var id;id={Log:class{constructor(e={}){if(void 0===e.nodeId)throw new Error("Expected node ID");if("object"!=typeof e.store)throw new Error("Expected store");if(e.nodeId.includes(" "))throw new Error("Space is prohibited in node ID");this.nodeId=e.nodeId,this.lastTime=0,this.sequence=0,this.store=e.store,this.emitter=s()}on(e,t){return this.emitter.on(e,t)}type(e,t,n="add"){return this.emitter.on(`${n}-${e}`,t)}async add(e,t={}){if(void 0===e.type)throw new Error('Expected "type" in action');let n=!1;if(void 0===t.id&&(n=!0,t.id=this.generateId()),void 0===t.time&&(t.time=parseInt(t.id)),void 0===t.reasons)t.reasons=[];else if(!Array.isArray(t.reasons))throw new Error('Expected "reasons" to be an array of strings');for(let e of t.reasons)if("string"!=typeof e)throw new Error('Expected "reasons" to be an array of strings');if(this.emitter.emit("preadd-"+e.type,e,t),this.emitter.emit("preadd",e,t),t.keepLast&&(this.removeReason(t.keepLast,{olderThan:t}),t.reasons.push(t.keepLast)),0===t.reasons.length&&n)return this.emitter.emit("add-"+e.type,e,t),this.emitter.emit("add",e,t),this.emitter.emit("clean-"+e.type,e,t),this.emitter.emit("clean",e,t),t;if(0===t.reasons.length){let[n]=await this.store.byId(t.id);return!n&&(this.emitter.emit("add-"+e.type,e,t),this.emitter.emit("add",e,t),this.emitter.emit("clean-"+e.type,e,t),this.emitter.emit("clean",e,t),t)}{let n=await this.store.add(e,t);return!1!==n&&(this.emitter.emit("add-"+e.type,e,t),this.emitter.emit("add",e,n),n)}}generateId(){let e=Date.now();return e<=this.lastTime?(e=this.lastTime,this.sequence+=1):(this.lastTime=e,this.sequence=0),e+" "+this.nodeId+" "+this.sequence}each(e,t){t||(t=e,e={order:"created"});let n=this.store;return new Promise((r=>{!async function e(n){let o,i=await n();for(let e=i.entries.length-1;e>=0;e--){let n=i.entries[e];if(o=t(n[0],n[1]),!1===o)break}!1!==o&&i.next?e(i.next):r()}(n.get.bind(n,e))}))}async changeMeta(e,t){for(let e in t)if("id"===e||"added"===e||"time"===e||"subprotocol"===e)throw new Error('Meta "'+e+'" is read-only');if(t.reasons&&0===t.reasons.length){let n=await this.store.remove(e);if(n){for(let e in t)n[1][e]=t[e];this.emitter.emit("clean-"+n[0].type,n[0],n[1]),this.emitter.emit("clean",n[0],n[1])}return!!n}return this.store.changeMeta(e,t)}removeReason(e,t={}){return this.store.removeReason(e,t,((e,t)=>{this.emitter.emit("clean-"+e.type,e,t),this.emitter.emit("clean",e,t)}))}byId(e){return this.store.byId(e)}}};let{Log:ad}=id;rd={TestLog:class extends ad{constructor(e,t,n={}){n.store||(n.store=new od),void 0===n.nodeId&&(n.nodeId="test"+t),super(n),this.time=e}entries(){return this.store.entries}actions(){return this.entries().map((e=>e[0]))}generateId(){return this.time.lastTime+=1,this.time.lastTime+" "+this.nodeId+" 0"}}};let{TestLog:sd}=rd;class cd{static getLog(e){return(new cd).nextLog(e)}constructor(){this.lastId=0,this.lastTime=0}nextLog(e){return this.lastId+=1,new sd(this,this.lastId,e)}}nd={TestTime:cd};let{TestTime:ld}=nd,{BaseNode:ud}=Jl;var dd;let{LocalPair:pd}=Yu;function fd(e){if(Array.isArray(e))return e.map((e=>fd(e)));if("object"==typeof e){let t={};for(let n in e)t[n]=fd(e[n]);return t}return e}dd={TestPair:class extends pd{constructor(e){super(e),this.leftNode=void 0,this.rightNode=void 0,this.clear(),this.unbind=[this.left.on("connect",(()=>{this.leftEvents.push(["connect"]),this.waiting&&this.waiting("left")})),this.right.on("connect",(()=>{this.rightEvents.push(["connect"]),this.waiting&&this.waiting("right")})),this.left.on("message",(e=>{let t=fd(e);this.rightSent.push(t),this.leftEvents.push(["message",t]),this.waiting&&this.waiting("left")})),this.right.on("message",(e=>{let t=fd(e);this.leftSent.push(t),this.rightEvents.push(["message",t]),this.waiting&&this.waiting("right")})),this.left.on("disconnect",(e=>{this.leftEvents.push(["disconnect",e]),this.waiting&&this.waiting("left")})),this.right.on("disconnect",(()=>{this.rightEvents.push(["disconnect"]),this.waiting&&this.waiting("right")}))]}clear(){this.leftSent=[],this.rightSent=[],this.leftEvents=[],this.rightEvents=[]}wait(e){return new Promise((t=>{this.waiting=n=>{e&&n!==e||(this.waiting=!1,t(this))}}))}}};let{TestPair:yd}=dd;var hd;hd={parseId:function(e){e.includes(" ")&&(e=e.split(" ")[1]);let t=e.split(":");return 1===t.length?{nodeId:e,userId:void 0,clientId:e}:{nodeId:e,userId:t[0],clientId:t[0]+":"+t[1]}}};let{parseId:gd}=hd,{Log:md}=id;a={ServerConnection:l,eachStoreCheck:Cl,isFirstOlder:_l,WsConnection:Bl,MemoryStore:$l,ClientNode:Fu,ServerNode:Gu,LoguxError:Ju,LocalPair:Ku,Reconnect:td,TestTime:ld,BaseNode:ud,TestPair:yd,parseId:gd,Log:md};var bd;let{LoguxError:vd}=Xl;var wd;let{isFirstOlder:Sd}=Dl,{WsConnection:Ed}=i,{MemoryStore:Ad}=ql,{ClientNode:Pd}=Gl,{Reconnect:Od}=Qu,{parseId:Id}=hd;let jd=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let r=63&n[e];t+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r<63?"_":"-"}return t},{Log:xd}=id,Td=["id","time","subprotocol"];function kd(e){localStorage.setItem(e.options.prefix+":tab:"+e.tabId,Date.now())}function Rd(e,t){e.log.removeReason("tab"+t).then((()=>{e.isLocalStorage&&localStorage.removeItem(e.options.prefix+":tab:"+t)}))}wd={Client:class{constructor(e={}){if(this.options=e,this.objects=new Map,void 0===this.options.prefix&&(this.options.prefix="logux"),this.isLocalStorage=!1,"undefined"!=typeof localStorage){let e=jd();try{localStorage.setItem(e,"1"),localStorage.removeItem(e),this.isLocalStorage=!0}catch{}}this.options.time?(this.tabId=this.options.time.lastId+1+"",this.clientId=this.options.userId+":"+this.tabId):(this.clientId=this.options.userId+":"+this.getClientId(),this.tabId=jd(8)),this.nodeId=this.clientId+":"+this.tabId;let t,n=this.options.store||new Ad;t=this.options.time?this.options.time.nextLog({store:n,nodeId:this.nodeId}):new xd({store:n,nodeId:this.nodeId}),this.log=t,t.on("preadd",((e,t)=>{Id(t.id).nodeId!==this.nodeId||t.subprotocol||(t.subprotocol=this.options.subprotocol),t.sync&&!t.resubscribe&&t.reasons.push("syncing")})),this.last={},this.subscriptions={};let r={},o={};this.emitter=s(),this.on("add",((e,t)=>{let n,i,a=e.type;if("logux/processed"!==a&&"logux/undo"!==a||this.log.removeReason("syncing",{id:e.id}),"logux/subscribe"!==a||t.resubscribe)if("logux/unsubscribe"===a)o[t.id]=e;else if("logux/processed"===a){if(o[e.id]){let t=o[e.id];n=JSON.stringify({...t,type:"logux/subscribe"});let r=this.subscriptions[n];r&&(1===r?delete this.subscriptions[n]:this.subscriptions[n]=r-1)}if(r[e.id]){let o=r[e.id];delete r[e.id],n=JSON.stringify(o),this.subscriptions[n]?this.subscriptions[n]+=1:this.subscriptions[n]=1,i=this.last[o.channel],i&&!Sd(i,t)||(this.last[o.channel]={id:t.id,time:t.time})}"logux/processed"===a&&this.processing[e.id]&&(this.processing[e.id][0](t),delete this.processing[e.id])}else if("logux/undo"===a){if(this.processing[e.id]){let t=new Error("Server undid Logux action because of "+e.reason);t.action=e,this.processing[e.id][1](t),delete this.processing[e.id]}delete r[e.id],delete o[e.id]}else t.channels&&(t.id.includes(" "+this.clientId+":")||t.channels.forEach((e=>{i=this.last[e],i&&!Sd(i,t)||(this.last[e]={id:t.id,time:t.time})})));else r[t.id]=e})),this.tabPing=6e4,this.tabTimeout=10*this.tabPing;let i,a="tab"+this.tabId;if(this.isLocalStorage){let e=t.on("add",((t,n)=>{n.reasons.includes(a)&&(kd(this),this.pinging=setInterval((()=>{kd(this)}),this.tabPing),e())}))}if("string"==typeof this.options.server){let e=new Ed(this.options.server);i=new Od(e,{minDelay:this.options.minDelay,maxDelay:this.options.maxDelay,attempts:this.options.attempts})}else i=this.options.server;if(this.node=new Pd(this.nodeId,this.log,i,{subprotocol:this.options.subprotocol,outFilter:async(e,t)=>!!t.sync&&Id(t.id).userId===this.options.userId,timeout:this.options.timeout,outMap:async(e,t)=>{let n={};for(let e in t)"subprotocol"===e?t.subprotocol!==this.options.subprotocol&&(n.subprotocol=t.subprotocol):Td.includes(e)&&(n[e]=t[e]);return[e,n]},token:this.options.token,ping:this.options.ping}),/^ws:\/\//.test(this.options.server)&&!e.allowDangerousProtocol){let e=this.node.on("state",(()=>{"synchronized"===this.node.state&&(e(),"development"!==this.node.remoteHeaders.env&&(console.error("Without SSL, old proxies block WebSockets. Use WSS for Logux or set allowDangerousProtocol option."),this.destroy()))}))}this.node.on("debug",((e,t)=>{"error"===e&&console.error("Error on Logux server:\n",t)}));let c=!0;this.node.on("state",(()=>{let e=this.node.state;if("synchronized"===e||"sending"===e){if(c){c=!1;for(let e in this.subscriptions){let t=JSON.parse(e),n=this.last[t.channel];n&&(t.since=n),this.log.add(t,{sync:!0,resubscribe:!0})}}}else"disconnected"===this.node.state&&(c=!0)})),this.onUnload=this.onUnload.bind(this),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener("unload",this.onUnload),this.processing={}}get state(){return this.node.state}get connected(){return"disconnected"!==this.state&&"connecting"!==this.state}start(){this.cleanPrevActions(),this.node.connection.connect()}sync(e,t={}){return t.sync=!0,void 0===t.id&&(t.id=this.log.generateId()),new Promise(((n,r)=>{this.processing[t.id]=[n,r],this.log.add(e,t)}))}type(e,t,n="add"){return this.log.type(e,t,n)}on(e,t){return"state"===e?this.node.emitter.on(e,t):"user"===e?this.emitter.on(e,t):this.log.emitter.on(e,t)}changeUser(e,t){let n=this.node.connected;n&&this.node.connection.disconnect("destroy"),this.options.userId=e,this.options.token=t,this.clientId=e+":"+this.clientId.split(":")[1],this.nodeId=this.clientId+":"+this.tabId,this.log.nodeId=this.nodeId,this.node.localNodeId=this.nodeId,this.node.options.token=t,this.emitter.emit("user",e),n&&this.node.connection.connect()}waitFor(e){return this.state===e?Promise.resolve():new Promise((t=>{let n=this.on("state",(()=>{this.state===e&&(n(),t())}))}))}destroy(){this.onUnload(),this.node.destroy(),clearInterval(this.pinging),"undefined"!=typeof window&&window.removeEventListener&&window.removeEventListener("unload",this.onUnload)}clean(){return this.destroy(),this.log.store.clean?this.log.store.clean():Promise.resolve()}cleanPrevActions(){if(this.isLocalStorage)for(let e in localStorage){let t=this.options.prefix+":tab:";if(e.slice(0,t.length)===t){let n=parseInt(localStorage.getItem(e));Date.now()-n>this.tabTimeout&&Rd(this,e.slice(t.length))}}}onUnload(){this.pinging&&Rd(this,this.tabId)}getClientId(){return jd(8)}}};let{Client:Fd}=wd;function Nd(e,t){return e.options.prefix+":"+e.options.userId+":"+t}function Md(e,t,n){if(!e.isLocalStorage)return;let r=Nd(e,t),o=JSON.stringify(n);try{localStorage.setItem(r,o)}catch(t){console.error(t),e.isLocalStorage=!1,e.role="leader",e.emitter.emit("role"),e.node.connection.connect()}}function Ld(e){let t=localStorage.getItem(Nd(e,"leader")),n=[];return"string"==typeof t&&(n=JSON.parse(t)),n}function Ud(e){Md(e,"leader",[e.tabId,Date.now()])}function Cd(e){"disconnected"!==e.state&&Wd(e,"disconnected"),qd(e)}function Dd(e){clearTimeout(e.watching),e.watching=setTimeout((()=>{Bd(e)?Dd(e):Cd(e)}),e.roleTimeout)}function _d(e,t){if(e.role!==t){let n=e.node;if(e.role=t,clearTimeout(e.watching),"leader"===t?(localStorage.removeItem(Nd(e,"state")),e.leadership=setInterval((()=>{e.unloading||Ud(e)}),e.leaderPing),n.connection.connect()):(clearTimeout(e.elections),clearInterval(e.leadership),"disconnected"!==n.state&&e.node.connection.disconnect()),"follower"===t){let t="disconnected",n=localStorage.getItem(Nd(e,"state"));n&&null!==n&&(t=JSON.parse(n)),t!==e.state&&(e.state=t,e.emitter.emit("state"))}e.emitter.emit("role")}}function Bd(e){let t=Ld(e);return t[1]&&t[1]>=Date.now()-e.leaderTimeout}function qd(e){Ud(e),_d(e,"candidate"),e.elections=setTimeout((()=>{Ld(e)[0]===e.tabId?_d(e,"leader"):(_d(e,"follower"),Dd(e))}),e.electionDelay)}function Wd(e,t){e.state=t,e.emitter.emit("state"),Md(e,"state",e.state)}bd={CrossTabClient:class extends Fd{constructor(e={}){if(super(e),this.role="candidate",this.roleTimeout=3e3+Math.floor(1e3*Math.random()),this.leaderTimeout=5e3,this.leaderPing=2e3,this.electionDelay=1e3,this.leaderState=this.node.state,this.node.on("state",(()=>{"leader"===this.role&&Wd(this,this.node.state)})),this.log.on("add",((e,t)=>{this.emitter.emit("add-"+e.type,e,t),this.emitter.emit("add",e,t),t.tab!==this.tabId&&Md(this,"add",[this.tabId,e,t])})),this.log.on("clean",((e,t)=>{this.emitter.emit("clean-"+e.type,e,t),this.emitter.emit("clean",e,t)})),"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("storage",(e=>this.onStorage(e))),window.addEventListener("unload",(e=>this.onUnload(e)))),this.isLocalStorage){let e=Nd(this,"subprotocol");localStorage.getItem(e)!==this.options.subprotocol&&Md(this,"subprotocol",this.options.subprotocol)}}get state(){return this.leaderState}set state(e){this.leaderState=e}start(){if(this.cleanPrevActions(),!this.isLocalStorage)return this.role="leader",this.emitter.emit("role"),void this.node.connection.connect();Bd(this)?(_d(this,"follower"),Dd(this)):qd(this)}destroy(){super.destroy(),clearTimeout(this.watching),clearTimeout(this.elections),clearInterval(this.leadership),"undefined"!=typeof window&&window.removeEventListener&&window.removeEventListener("storage",this.onStorage)}clean(){return this.isLocalStorage&&(localStorage.removeItem(Nd(this,"add")),localStorage.removeItem(Nd(this,"state")),localStorage.removeItem(Nd(this,"client")),localStorage.removeItem(Nd(this,"leader"))),super.clean()}changeUser(e,t){Md(this,"user",[this.tabId,e]),super.changeUser(e,t)}type(e,t,n="add"){return"preadd"===n?this.log.type(e,t,n):this.emitter.on(`${n}-${e}`,t)}on(e,t){return"preadd"===e?this.log.emitter.on(e,t):this.emitter.on(e,t)}onStorage(e){if(null===e.newValue)return;let t;if(e.key===Nd(this,"add")){if(t=JSON.parse(e.newValue),t[0]!==this.tabId){let e=t[1],r=t[2];r.tab&&r.tab!==this.tabId||(n=this.log.store,Array.isArray(n.entries)&&Array.isArray(n.added)&&this.log.store.add(e,r),this.emitter.emit("add-"+e.type,e,r),this.emitter.emit("add",e,r),"leader"===this.role&&this.node.onAdd(e,r))}}else if(e.key===Nd(this,"leader"))t=JSON.parse(e.newValue),0===t.length?Cd(this):t[0]!==this.tabId&&"candidate"!==this.role&&(_d(this,"follower"),Dd(this));else if(e.key===Nd(this,"state")){let t=JSON.parse(localStorage.getItem(e.key));this.leaderState!==t&&(this.leaderState=t,this.emitter.emit("state"))}else if(e.key===Nd(this,"user"))t=JSON.parse(e.newValue),t[0]!==this.tabId&&this.emitter.emit("user",t[1]);else if(e.key===Nd(this,"subprotocol")){let t=JSON.parse(e.newValue),n=function(e,t){let n=e.split("."),r=t.split(".");for(let e=0;e<3;e++){let t=parseInt(n[e]||0),o=parseInt(r[e]||0);if(t>o)return 1;if(t<o)return-1}return 0}(this.options.subprotocol,t);if(1===n)Md(this,"subprotocol",this.options.subprotocol);else if(-1===n){let e=new vd("wrong-subprotocol",{supported:t,used:this.options.subprotocol},!0);this.node.emitter.emit("error",e)}}var n}onUnload(){"leader"===this.role&&(this.unloading=!0,Md(this,"leader",[])),super.onUnload()}getClientId(){let e=Nd(this,"client");if(this.isLocalStorage){if(localStorage.getItem(e))return localStorage.getItem(e);{let t=super.getClientId();return localStorage.setItem(e,t),t}}return super.getClientId()}}};var zd={},Hd={};Hd={status:function(e,t,n={}){let r,o=e.on?e:e.node,i="disconnected"===o.state,a=!1,s=!1;void 0===n.duration&&(n.duration=3e3);let c=[],l={};function u(){0===Object.keys(l).length&&(a?(a=!1,t("synchronizedAfterWait"),r=setTimeout((()=>{t("synchronized")}),n.duration)):t("synchronized"))}function d(){clearTimeout(r),s||("disconnected"===o.state?(i=!0,t(a?"wait":"disconnected")):"synchronized"===o.state?(i=!1,u()):"connecting"===o.state?r=setTimeout((()=>{t("connecting"+(a?"AfterWait":""))}),100):t(e.state+(a?"AfterWait":"")))}c.push(o.on("state",d)),c.push(e.node.on("error",(e=>{"wrong-protocol"===e.type||"wrong-subprotocol"===e.type?(s=!0,t("protocolError")):"timeout"!==e.type&&t("syncError",{error:e})}))),c.push(e.node.on("clientError",(e=>{t("syncError",{error:e})})));let p=e.on?e:e.log;return c.push(p.on("add",((e,n)=>{"logux/subscribe"!==e.type&&"logux/unsubscribe"!==e.type&&("logux/processed"===e.type?(delete l[e.id],u()):"logux/undo"===e.type?delete l[e.id]:n.sync&&(l[n.id]=!0),"logux/undo"===e.type&&e.reason?"denied"===e.reason?t("denied",{action:e,meta:n}):t("error",{action:e,meta:n}):i&&n.sync&&n.added&&(a||t("wait"),a=!0))}))),d(),()=>{for(let e of c)e()}}};let{status:Vd}=Hd;function $d(e,t){for(let n in t)e.style[n]=t[n]}const Gd={boxSizing:"content-box",visibility:"visible",textIndent:"0",textTransform:"none",wordSpacing:"normal",letterSpacing:"normal",fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",lineHeight:"auto"};zd={badge:function(e,t){let n=t.messages,r=t.position||"bottom-right",o=t.styles,i=document.createElement("div"),a=document.createElement("span");i.setAttribute("role","alert"),$d(i,Gd),$d(i,o.base),$d(a,o.text),function(e,t){let n=e.style;"middle-center"===t||"center-middle"===t?(n.top="50%",n.left="50%",n.transform="translate(-50%, -50%)"):t.split("-").forEach((e=>{"middle"===e?(n.top="50%",n.transform="translateY(-50%)"):"center"===e?(n.left="50%",n.transform="translateX(-50%)"):n[e]="0"}))}(i,r);let s=(e,t)=>{a.innerHTML=t,$d(i,e),i.style.display="block"},c=Vd(e,(e=>{"sendingAfterWait"===e||"connectingAfterWait"===e?s(o.sending,n.sending):"synchronizedAfterWait"===e?s(o.synchronized,n.synchronized):"synchronized"===e?i.style.display="none":"disconnected"===e?s(o.disconnected,n.disconnected):"wait"===e?s(o.wait,n.wait):"protocolError"===e?s(o.protocolError,n.protocolError):"syncError"===e?s(o.error,n.syncError):"error"===e?s(o.error,n.error):"denied"===e&&s(o.error,n.denied)}),t);return i.appendChild(a),document.body.appendChild(i),()=>{c(),document.body.removeChild(i)}},badgeEn:{synchronized:"Your data has been saved",disconnected:"No Internet connection",wait:"No Internet connection<br>Your data has not been saved",sending:"Data saving",syncError:"Server error<br>Your data has not been saved",error:"Server error<br>You changes was reverted",denied:"You have no access<br>You changes was reverted",protocolError:"Saving is not working<br>Refresh the page"},badgeRu:{synchronized:"Ваши данные сохранены",disconnected:"Нет интернета",wait:"Нет интернета<br>Ваши данные не сохранены",sending:"Сохраняю ваши данные",syncError:"Ошибка на сервере<br>Ваши данные не сохранены",error:"Ошибка на сервере<br>Ваши действия отменены",denied:"Нет прав<br>Ваши действия отменены",protocolError:"Сохранение не работает<br>Обновите страницу"}};var Jd,Yd,Xd=null;var Kd,Qd=function(){return Xd||(Xd=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(e)return(""+e[0]).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}()),Xd},Zd=r;function ep(e){if(""===e)return".";var t="/"===e[e.length-1]?e.slice(0,e.length-1):e,n=t.lastIndexOf("/");return-1===n?".":t.slice(0,n)}function tp(e,t){if(e===t)return"";var n=e.split("/");"."===n[0]&&n.shift();var r,o,i=t.split("/");for("."===i[0]&&i.shift(),r=0;(r<i.length||r<n.length)&&null==o;r++)n[r]!==i[r]&&(o=r);var a=[];for(r=0;r<n.length-o;r++)a.push("..");return i.length>o&&a.push.apply(a,i.slice(o)),a.join("/")}(Kd=function(e,t){return tp(ep(Zd(e)),Zd(t))})._dirname=ep,Kd._relative=tp,Yd=Qd()+Kd("5scof","16ppc");var np;Jd={badgeStyles:{base:{position:"fixed",width:"15.4em",height:"4em",lineHeight:"1.4",margin:"1.5em",paddingLeft:"4.2em",opacity:"0.8",borderRadius:"0.4em",color:"#fff",fontFamily:"Helvetica Neue, sans-serif",zIndex:"999",backgroundPosition:"1.2em center",backgroundRepeat:"no-repeat",backgroundSize:"1.8em"},text:{display:"table-cell",verticalAlign:"middle",height:"4em"},synchronized:{backgroundColor:"#000",backgroundImage:"url("+(Qd()+Kd("5scof","46GSN"))+")"},disconnected:{backgroundColor:"#000",backgroundImage:"url("+(np=Qd()+Kd("5scof","5ukcI"))+")"},wait:{backgroundColor:"#000",backgroundImage:"url("+np+")"},sending:{backgroundColor:"#000",backgroundImage:"url("+Yd+")"},error:{backgroundColor:"#F42A2A",backgroundImage:"url("+(Qd()+Kd("5scof","2zEXf"))+")"},protocolError:{backgroundColor:"#000",backgroundImage:"url("+Yd+")"}}};var rp={};rp={attention:function(e){let t=document,n=!1,r=[],o=!1,i=()=>{n&&(t.title=n,n=!1)},a=()=>{t.hidden&&!n?(n=t.title,t.title="* "+t.title):i(),t.hidden&&(o=setTimeout(a,1e3))},s=()=>{!t.hidden&&o&&(o=clearTimeout(o),i())};return t&&void 0!==t.hidden&&(r.push(e.node.on("error",(e=>{"timeout"===e.type||o||a()}))),r.push(e.on("add",(e=>{"logux/undo"===e.type&&e.reason&&!o&&a()}))),document.addEventListener("visibilitychange",s,!1),r.push((()=>{document.removeEventListener("visibilitychange",s,!1)}))),()=>{for(let e of r)e()}}};var op={};function ip(e){return e.returnValue="unsynced","unsynced"}op={confirm:function(e){let t="disconnected"===e.state,n=!1,r=()=>{"disconnected"===e.state?t=!0:"synchronized"===e.state&&(t=!1,n=!1),"undefined"!=typeof window&&window.addEventListener&&("follower"!==e.role&&n&&t?window.addEventListener("beforeunload",ip):window.removeEventListener("beforeunload",ip))},o=[];return o.push(e.on("role",r)),o.push(e.on("state",r)),r(),o.push(e.on("add",((e,o)=>{"logux/subscribe"!==e.type&&"logux/unsubscribe"!==e.type&&t&&o.sync&&o.added&&(n=!0,r())}))),()=>{for(let e of o)e()}}};var ap={};ap={favicon:function(e,t){let n=t.normal,r=t.offline,o=t.error,i=[],a=document,s=!1,c=!1;function l(){e.connected&&c!==n?s.href=c=n:!e.connected&&r&&c!==r&&c!==o&&(s.href=c=r)}function u(){o&&c!==o&&(s.href=c=o)}return a&&(s=a.querySelector('link[rel~="icon"]'),void 0===n&&(n=s?s.href:""),s||(s=a.createElement("link"),s.rel="icon",s.href="",a.head.appendChild(s)),i.push(e.on("state",l)),l(),i.push(e.on("add",(e=>{"logux/undo"===e.type&&e.reason&&u()}))),i.push(e.node.on("error",(e=>{"timeout"!==e.type&&u()})))),()=>{for(let e of i)e()}}};var sp={};let{parseId:cp}=hd;function lp(e){return"%c"+e+"%c"}function up(e,t){e="%cLogux%c "+e;let n=Array.from(e.match(/%c/g)).map(((e,t)=>0===t?"color:#ffa200;font-weight:bold":t%2==0?"font-weight:bold":"font-weight:normal"));if(t){console.groupCollapsed(e,...n);for(let e in t)"string"==typeof t[e]?console.log(e+": %c"+t[e],"font-weight:bold"):console.log(e,t[e]);console.groupEnd()}else console.log(e,...n)}sp={log:function(e,t={}){let n=e.node,r={},o=[],i=!1;!1!==t.state&&o.push(e.on("state",(()=>{let t;"connecting"===e.state&&n.connection.url?t={"Node ID":n.localNodeId,Server:n.connection.url}:e.connected&&!i&&n.remoteNodeId?(i=!0,t={"Server ID":n.remoteNodeId}):e.connected||(i=!1),up("state is "+lp(e.state),t)}))),!1!==t.role&&o.push(e.on("role",(()=>{up("tab role is "+lp(e.role))})));let a={},s=(t.ignoreActions||[]).reduce(((e,t)=>(e[t]=!0,e)),{});return!1!==t.add&&o.push(e.on("add",((t,o)=>{if(o.tab&&o.tab!==e.tabId)return;if(s[t.type])return;let i;if(o.sync&&(r[o.id]=t),"logux/subscribe"===t.type)i="subscribing to "+lp(t.channel)+" channel",2===Object.keys(t).length?up(i):up(i,{Action:t});else if("logux/unsubscribe"===t.type)i="unsubscribed from channel "+lp(t.channel),2===Object.keys(t).length?up(i):up(i,{Action:t});else if("logux/processed"===t.type)if(r[t.id]){let e=r[t.id],n={"Processed Action":e};"logux/subscribe"===e.type?up("subscribed to "+lp(e.channel)+" channel",n):up("action "+lp(e.type)+" was processed",n),delete r[t.id]}else up("action "+lp(t.id)+" was processed");else if("logux/undo"===t.type){i="logux/subscribe"===t.action.type?"subscription to "+lp(t.action.channel):"action "+lp(t.action.type),i+=" was undone because of "+lp(t.reason);let e={"Reverted Action":t.action};Object.keys(t).length>4&&(e["Undo Action"]=t),r[t.id]&&delete r[t.id],up(i,e)}else{let e={Action:t,Meta:o};i="added ",0===o.reasons.length&&(a[o.id]=!0,i+="and cleaned "),i+=lp(t.type)+" action";let{nodeId:r}=cp(o.id);r!==n.localNodeId&&(e.From=r),up(i,e)}}))),!1!==t.user&&o.push(e.on("user",(t=>{up("user ID was changed to "+lp(t),{"Node ID":e.nodeId})}))),!1!==t.clean&&o.push(e.on("clean",((t,n)=>{if(a[n.id])return void delete a[n.id];if(n.tab&&n.tab!==e.id)return;if(s[t.type])return;if(t.type.startsWith("logux/"))return;up("cleaned "+lp(t.type)+" action",{Action:t,Meta:n})}))),()=>{for(let e of o)e()}}};var dp;dp=Qd()+Kd("5scof","2KpQ0");var pp;pp=Qd()+Kd("5scof","6hsse");var fp;fp=Qd()+Kd("5scof","bXmWT");let yp=new a.LocalPair(500),hp=new a.Log({store:new a.MemoryStore,nodeId:"server:uuid"});new a.BaseNode("server:uuid",hp,yp.right),hp.on("add",((e,t)=>{"logux/processed"!==e.type&&setTimeout((()=>{hp.add({type:"logux/processed",id:t.id})}),500)}));let gp=new bd.CrossTabClient({subprotocol:location.hash.slice(1)||"1.0.0",userId:"10",server:"wss://example.com/"});console.log(gp.options);let mp=new a.ClientNode(gp.node.localNodeId,gp.log,yp.left);mp.connection.url="wss://example.com/",mp.emitter=gp.node.emitter,gp.node=mp,rp.attention(gp),op.confirm(gp);var bp=e(pp),vp=e(dp),wp=e(fp);ap.favicon(gp,{normal:bp,offline:vp,error:wp}),zd.badge(gp,{messages:zd.badgeEn,styles:Jd.badgeStyles}),sp.log(gp),Hd.status(gp,(e=>{document.all.status.innerText=e}));let Sp=0;function Ep(){var e;document.title=("disconnected"===(e=gp.state)?"😴":"connecting"===e?"🔌":"😊")+" "+(gp.role.slice(0,1).toUpperCase()+" ")+Sp}gp.on("state",(()=>{document.all.connection.checked=gp.connected,Ep()})),gp.on("role",(()=>{Ep(),document.all.connection.disabled="leader"!==gp.role})),gp.on("add",(e=>{"TICK"===e.type&&Sp++,Ep()})),gp.on("clean",(e=>{"TICK"===e.type&&Sp--,Ep()})),gp.log.each((e=>{"TICK"===e.type&&Sp++})).then((()=>{Ep()})),gp.on("role",(()=>{let e="leader"===gp.role;document.all.connection.disabled=!e,document.all.disabled.style.display=e?"none":"inline"})),gp.start(),document.all.connection.onchange=e=>{e.target.checked?gp.node.connection.connect():gp.node.connection.disconnect()},document.all.add.onclick=()=>{gp.log.add({type:"TICK"},{reasons:["tick"],sync:!0})},document.all.clean.onclick=()=>{gp.log.removeReason("tick")},document.all.error.onclick=()=>{setTimeout((()=>{gp.log.add({type:"logux/undo",reason:"error"})}),3e3)},document.all.denied.onclick=()=>{setTimeout((()=>{gp.log.add({type:"logux/undo",reason:"denied"})}),3e3)},document.all.serverError.onclick=()=>{setTimeout((()=>{yp.right.send(["error","wrong-format"])}),3e3)},document.all.subprotocolError.onclick=()=>{gp.node.syncError("wrong-subprotocol",{supported:"2.x",used:"1.0.0"})},"1.0.1"===gp.options.subprotocol?document.all.subprotocolClient.disabled=!0:document.all.subprotocolClient.onclick=()=>{window.open(location.toString()+"#1.0.1","_blank")}}();
//# sourceMappingURL=index.b379df14.js.map
